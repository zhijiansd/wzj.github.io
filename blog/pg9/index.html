<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.5.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.5.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.5.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.5.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="管理数据库CREATE DATABASE语句CREATE DATABASE语法 要创建新的PostgreSQL数据库，请使用CREATE DATABASE语句，如下所示:  12345678CREATE DATABASE db_name OWNER =  role_name TEMPLATE = template ENCODING = encoding LC_COLLATE = collate L">
<meta name="keywords" content="pg">
<meta property="og:type" content="article">
<meta property="og:title" content="PostgreSQL之管理数据库和表">
<meta property="og:url" content="www.wangzhijian.cn/blog/pg9/index.html">
<meta property="og:site_name" content="ZhiJian">
<meta property="og:description" content="管理数据库CREATE DATABASE语句CREATE DATABASE语法 要创建新的PostgreSQL数据库，请使用CREATE DATABASE语句，如下所示:  12345678CREATE DATABASE db_name OWNER =  role_name TEMPLATE = template ENCODING = encoding LC_COLLATE = collate L">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-05-20T04:58:22.843Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PostgreSQL之管理数据库和表">
<meta name="twitter:description" content="管理数据库CREATE DATABASE语句CREATE DATABASE语法 要创建新的PostgreSQL数据库，请使用CREATE DATABASE语句，如下所示:  12345678CREATE DATABASE db_name OWNER =  role_name TEMPLATE = template ENCODING = encoding LC_COLLATE = collate L">






  <link rel="canonical" href="www.wangzhijian.cn/blog/pg9/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>PostgreSQL之管理数据库和表 | ZhiJian</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ZhiJian</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="www.wangzhijian.cn/blog/pg9/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhiJian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhiJian">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">PostgreSQL之管理数据库和表
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-05-20 12:56:46 / 修改时间：12:58:22" itemprop="dateCreated datePublished" datetime="2020-05-20T12:56:46+08:00">2020-05-20</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/postresql/" itemprop="url" rel="index"><span itemprop="name">postresql</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/pg9/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/blog/pg9/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">55k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">1:31</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="管理数据库"><a href="#管理数据库" class="headerlink" title="管理数据库"></a>管理数据库</h2><h3 id="CREATE-DATABASE语句"><a href="#CREATE-DATABASE语句" class="headerlink" title="CREATE DATABASE语句"></a>CREATE DATABASE语句</h3><h4 id="CREATE-DATABASE语法"><a href="#CREATE-DATABASE语法" class="headerlink" title="CREATE DATABASE语法"></a>CREATE DATABASE语法</h4><blockquote>
<p>要创建新的PostgreSQL数据库，请使用CREATE DATABASE语句，如下所示:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE db_name</span><br><span class="line"> OWNER =  role_name</span><br><span class="line"> TEMPLATE = template</span><br><span class="line"> ENCODING = encoding</span><br><span class="line"> LC_COLLATE = collate</span><br><span class="line"> LC_CTYPE = ctype</span><br><span class="line"> TABLESPACE = tablespace_name</span><br><span class="line"> CONNECTION LIMIT = max_concurrent_connection</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建新数据库时，CREATE DATABASE语句提供了各种选项:</p>
<ul>
<li>db_name：要创建的新数据库的名称。数据库名称在PostgreSQL数据库服务器中必须是唯一的。如果尝试创建一个与现有数据库同名的新数据库，PostgreSQL将发出错误消息。</li>
</ul>
<ul>
<li>role_name：拥有新数据库的用户的角色名称。PostgreSQL使用执行该CREATE DATABASE语句的用户角色名称作为默认角色名称。</li>
</ul>
<ul>
<li>template：是从中创建新数据库的数据库模板的名称。PostgreSQL允许您基于模板数据库创建数据库。template1是默认模板数据库。</li>
</ul>
<ul>
<li>encoding：指定新数据库的字符集编码。默认情况下，它是模板数据库的编码。</li>
</ul>
<ul>
<li>collate：指定新数据库的排序规则。 排序规则指定影响SELECT语句中ORDER BY子句结果的字符串的排序顺序。如果您未在LC_COLLATE参数中明确指定模板数据库的排序规则，则该排序规则是新数据库的默认排序规则。</li>
</ul>
<ul>
<li>ctype：指定新数据库的字符分类。该ctype影响分类例如:digit,lower和upper。默认值为模板数据库的字符分类。</li>
</ul>
<ul>
<li>tablespace_name：指定新数据库的表空间名称。默认值为模板数据库的表空间。</li>
</ul>
<ul>
<li>max_concurrent_connection：指定到新数据库的最大并发连接数。默认值为-1，即无限制。此功能在共享主机环境中非常有用，可以在其中为特定数据库配置最大并发连接数。</li>
</ul>
</blockquote>
<blockquote>
<p>除了CREATE DATABASE语句外，还可以使用createdb程序来创建新数据库。createdb程序在后台使用CREATE DATABASE语句。</p>
</blockquote>
<h4 id="创建数据库示例1"><a href="#创建数据库示例1" class="headerlink" title="创建数据库示例1"></a>创建数据库示例1</h4><blockquote>
<p>创建新数据库的最简单方法是使用所有默认设置，并且仅将数据库名称指定为以下查询：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE testdb1;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PostgreSQL创建了一个名为testdb1的新数据库，该数据库具有默认模板数据库（即template1）中的默认参数。</p>
</blockquote>
<h4 id="创建数据库示例2"><a href="#创建数据库示例2" class="headerlink" title="创建数据库示例2"></a>创建数据库示例2</h4><blockquote>
<p>使用以下参数创建新的数据库名称hrdb:</p>
<ul>
<li>编码：utf-8。</li>
</ul>
<ul>
<li>所有者：hr，并假设hr用户存在于数据库服务器中。</li>
</ul>
<ul>
<li>最大并发连接数：25。</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE hrdb</span><br><span class="line"> WITH ENCODING=<span class="string">'UTF8'</span></span><br><span class="line"> OWNER=hr</span><br><span class="line"> CONNECTION LIMIT=25;</span><br></pre></td></tr></table></figure>
<h3 id="ALTER-DATABASE语句"><a href="#ALTER-DATABASE语句" class="headerlink" title="ALTER DATABASE语句"></a>ALTER DATABASE语句</h3><h4 id="ALTER-DATABASE"><a href="#ALTER-DATABASE" class="headerlink" title="ALTER DATABASE"></a>ALTER DATABASE</h4><blockquote>
<p>创建数据库后，可以使用ALTER DATABASE语句更改其功能，如下所示:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER DATABASE target_database action;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以在ALTER DATABASE之后指定要更改的数据库名称。PostgreSQL允许对现有数据库执行各种操作。</p>
</blockquote>
<h4 id="重命名数据库"><a href="#重命名数据库" class="headerlink" title="重命名数据库"></a>重命名数据库</h4><blockquote>
<p>要重命名数据库，请使用ALTER DATABASE RENAME TO语句，如下所示:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER DATABASE target_database RENAME TO new_database;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要重命名数据库，您必须连接到另一个数据库，例如postgres。</p>
</blockquote>
<h4 id="变更拥有者"><a href="#变更拥有者" class="headerlink" title="变更拥有者"></a>变更拥有者</h4><blockquote>
<p>要更改数据库的所有者，请使用ALTER DATABASE OWNER TO语句:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER DATABASE target_database OWNER TO new_onwer;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>只有数据库的超级用户superuser可以更改数据库的所有者。数据库所有者还必须具有CREATEDB特权才能重命名数据库。</p>
</blockquote>
<h4 id="变更表空间"><a href="#变更表空间" class="headerlink" title="变更表空间"></a>变更表空间</h4><blockquote>
<p>要更改数据库的默认表空间，请按以下方式使用ALTER DATABASE SET TABLESPACE：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER DATABASE target_database SET TABLESPACE new_tablespace;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>该语句将表和索引从旧表空间移到新表空间。</p>
</blockquote>
<h4 id="更改运行时配置变量的会话默认值"><a href="#更改运行时配置变量的会话默认值" class="headerlink" title="更改运行时配置变量的会话默认值"></a>更改运行时配置变量的会话默认值</h4><blockquote>
<p>无论何时连接到数据库，PostgreSQL都会加载postgresql.conf文件中显示的配置变量，并默认使用这些变量。</p>
</blockquote>
<blockquote>
<p>要覆盖特定数据库的这些设置，请使用ALTER DATABASE SET语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER DATABASE target_database SET configuration_parameter = value;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在随后的会话中，PostgreSQL将覆盖postgresql.conf文件中的设置。</p>
</blockquote>
<blockquote>
<p>请注意，只有超级用户supperuser或数据库所有者才能更改数据库的默认会话变量。</p>
</blockquote>
<h4 id="ALTER-DATABASE示例"><a href="#ALTER-DATABASE示例" class="headerlink" title="ALTER DATABASE示例"></a>ALTER DATABASE示例</h4><blockquote>
<p>首先，以 postgres 用户身份登录并创建一个名为testdb2的新数据库</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># CREATE DATABASE testdb2;</span></span><br><span class="line">CREATE DATABASE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其次，使用以下语句将 testdb2 数据库重命名为testhrdb</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># ALTER DATABASE testdb2 RENAME TO testhrdb;</span></span><br><span class="line">ALTER DATABASE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第三，创建 hr 角色</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># CREATE ROLE hr</span></span><br><span class="line"> VALID UNTIL <span class="string">'infinity'</span>;</span><br><span class="line">CREATE ROLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第四，执行以下语句，将testhrdb数据库的所有者从postgres更改为hr。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># ALTER DATABASE testhrdb OWNER TO hr;</span></span><br><span class="line">ALTER DATABASE</span><br></pre></td></tr></table></figure>
<blockquote>
<p> 第五，创建表空间</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># CREATE TABLESPACE hr_default</span></span><br><span class="line"> OWNER hr</span><br><span class="line"> LOCATION <span class="string">'/usr/local/pgdata'</span>;</span><br><span class="line">CREATE TABLESPACE</span><br></pre></td></tr></table></figure>
<ul>
<li>/usr/local/pgdata目录必须存在且归属于postgres用户。</li>
</ul>
<blockquote>
<p>第六，将testhrdb的默认表空间从pg_default更改为hr_default</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># ALTER DATABASE testhrdb</span></span><br><span class="line">SET TABLESPACE hr_default;</span><br><span class="line">ALTER DATABASE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第七，要设置escape_string_warning配置变量为off，可以使用以下语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># ALTER DATABASE testhrdb SET escape_string_warning TO off;</span></span><br><span class="line">ALTER DATABASE</span><br></pre></td></tr></table></figure>
<h3 id="ALTER-DATABASE-RENAME-TO-语句"><a href="#ALTER-DATABASE-RENAME-TO-语句" class="headerlink" title="ALTER DATABASE RENAME TO 语句"></a>ALTER DATABASE RENAME TO 语句</h3><h4 id="重命名数据库步骤"><a href="#重命名数据库步骤" class="headerlink" title="重命名数据库步骤"></a>重命名数据库步骤</h4><blockquote>
<p>使用ALTER DATABASE RENAME TO语句重命名PostgreSQL数据库，请使用以下步骤:</p>
<ul>
<li>通过连接到其他数据库，与要重命名的数据库断开连接。</li>
</ul>
<ul>
<li>检查并终止与正在重命名的数据库的所有活动连接。</li>
</ul>
<ul>
<li>使用ALTER DATABASE语句将数据库重命名为新数据库。</li>
</ul>
</blockquote>
<h4 id="重命名数据库示例"><a href="#重命名数据库示例" class="headerlink" title="重命名数据库示例"></a>重命名数据库示例</h4><blockquote>
<p>重命名数据库test为newtest</p>
</blockquote>
<ul>
<li>首先，通过连接到另一个数据库（例如postgres），与要重命名的数据库断开连接。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; \connect postgres;</span><br><span class="line">您现在已经连接到数据库 <span class="string">"postgres"</span>,用户 <span class="string">"test"</span>.</span><br></pre></td></tr></table></figure>
<ul>
<li>接下来，检查与test数据库的所有活动连接:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># SELECT</span></span><br><span class="line">    *</span><br><span class="line">FROM</span><br><span class="line">    pg_stat_activity</span><br><span class="line">WHERE</span><br><span class="line">    datname = <span class="string">'test'</span>;</span><br><span class="line">postgres=<span class="comment"># SELECT</span></span><br><span class="line">    pid</span><br><span class="line">FROM</span><br><span class="line">    pg_stat_activity</span><br><span class="line">WHERE</span><br><span class="line">    datname = <span class="string">'test'</span>;</span><br><span class="line">  pid</span><br><span class="line">-------</span><br><span class="line"> 71941</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<ul>
<li>这里可能会发现要重命名的数据库具有许多活动连接。在这种情况下，您需要在终止连接之前通知各个用户以及应用程序所有者，以避免数据丢失。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># SELECT</span></span><br><span class="line">    pg_terminate_backend (pid)</span><br><span class="line">FROM</span><br><span class="line">    pg_stat_activity</span><br><span class="line">WHERE</span><br><span class="line">    datname = <span class="string">'test'</span>;</span><br><span class="line"> pg_terminate_backend</span><br><span class="line">----------------------</span><br><span class="line"> t</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<ul>
<li>重命名数据库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># ALTER DATABASE test RENAME TO newtest;</span></span><br><span class="line">ALTER DATABASE</span><br></pre></td></tr></table></figure>
<ul>
<li>重登录数据库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># psql -h 192.168.100.133 -U test -d newtest</span></span><br><span class="line">用户 <span class="built_in">test</span> 的口令：</span><br><span class="line">psql (12.1)</span><br><span class="line">输入 <span class="string">"help"</span> 来获取帮助信息.</span><br><span class="line"></span><br><span class="line">newtest=&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-h指定数据库IP，-U指定用户名，-d指定需要登录的数据库(默认用户名即数据库名)</p>
</blockquote>
<h3 id="DROP-DATABASE-语句"><a href="#DROP-DATABASE-语句" class="headerlink" title="DROP DATABASE 语句"></a>DROP DATABASE 语句</h3><blockquote>
<p>一旦不再需要数据库，可以使用DROP DATABASE语句将其删除。</p>
</blockquote>
<h4 id="DROP-DATABASE语法"><a href="#DROP-DATABASE语法" class="headerlink" title="DROP DATABASE语法"></a>DROP DATABASE语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE [IF EXISTS] name;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要删除数据库:</p>
<ul>
<li>在DROP DATABASE子句之后，指定要删除的数据库的名称。</li>
</ul>
<ul>
<li>使用IF EXISTS可以防止错误删除不存在的数据库，PostgreSQL将发出通知。</li>
</ul>
</blockquote>
<blockquote>
<p>DROP DATABASE语句永久删除目录条目和数据目录。此操作无法撤消，因此必须谨慎使用。</p>
</blockquote>
<blockquote>
<p>只有数据库所有者才能执行DROP DATABASE语句。此外，如果与数据库有任何活动连接，则无法执行DROP DATABASE语句。必须连接到另一个数据库（例如postgresql）才能执行DROP DATABASE语句。</p>
</blockquote>
<blockquote>
<p>PostgreSQL还提供了一个名为dropdb的实用程序来删除数据库。dropdb程序在后台执行DROP DATABASE语句。</p>
</blockquote>
<h4 id="删除具有活动连接的数据库"><a href="#删除具有活动连接的数据库" class="headerlink" title="删除具有活动连接的数据库"></a>删除具有活动连接的数据库</h4><blockquote>
<p>要删除仍具有活动连接的数据库，可以按照以下步骤操作:</p>
</blockquote>
<ul>
<li>首先，找到针对目标数据库进行的活动，可以通过以下查询pg_stat_activity查询该视图:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># SELECT</span></span><br><span class="line">   *</span><br><span class="line">FROM</span><br><span class="line">   pg_stat_activity</span><br><span class="line">WHERE</span><br><span class="line">   datname = <span class="string">'testhrdb'</span>;</span><br><span class="line"> datid | datname  |  pid  | usesysid | usename | application_name |   client_addr   | client_hostname | client_port |         backend_start         | xact_start | query_start |         state_change          | wait_event_type | wait_event | state | backend_xid | backend_xmin | query |  backend_type</span><br><span class="line">-------+----------+-------+----------+---------+------------------+-----------------+-----------------+-------------+-------------------------------+------------+-------------+-------------------------------+-----------------+------------+-------+-------------+--------------+-------+----------------</span><br><span class="line"> 17722 | testhrdb | 77367 |    16384 | <span class="built_in">test</span>    | psql             | 192.168.100.133 |                 |       41814 | 2019-11-27 11:32:02.213662+08 |            |             | 2019-11-27 11:32:02.231687+08 | Client          | ClientRead | idle  |             |              |       | client backend</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<ul>
<li>其次，通过发出以下查询来终止活动连接:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># SELECT</span></span><br><span class="line">   pg_terminate_backend (pg_stat_activity.pid)</span><br><span class="line">FROM</span><br><span class="line">   pg_stat_activity</span><br><span class="line">WHERE</span><br><span class="line">   pg_stat_activity.datname = <span class="string">'testhrdb'</span>;</span><br><span class="line"> pg_terminate_backend</span><br><span class="line">----------------------</span><br><span class="line"> t</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<ul>
<li>第三，执行DROP DATABASE语句:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># DROP DATABASE testhrdb;</span></span><br><span class="line">DROP DATABASE</span><br></pre></td></tr></table></figure>
<h4 id="DROP-DATABASE示例"><a href="#DROP-DATABASE示例" class="headerlink" title="DROP DATABASE示例"></a>DROP DATABASE示例</h4><h5 id="创建示例数据库"><a href="#创建示例数据库" class="headerlink" title="创建示例数据库"></a>创建示例数据库</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># CREATE DATABASE hrdb;</span></span><br><span class="line">CREATE DATABASE testdb1;</span><br><span class="line">CREATE DATABASE</span><br><span class="line"></span><br><span class="line">CREATE DATABASE</span><br></pre></td></tr></table></figure>
<h5 id="删除没有活动连接的数据库"><a href="#删除没有活动连接的数据库" class="headerlink" title="删除没有活动连接的数据库"></a>删除没有活动连接的数据库</h5><blockquote>
<p>要删除hrdb数据库，请使用hrdb所有者连接到hrdb数据库以外的数据库，如postgres并执行以下语句:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># DROP DATABASE hrdb;</span></span><br><span class="line">DROP DATABASE</span><br></pre></td></tr></table></figure>
<h5 id="删除具有活动连接的数据库-1"><a href="#删除具有活动连接的数据库-1" class="headerlink" title="删除具有活动连接的数据库"></a>删除具有活动连接的数据库</h5><ul>
<li>删除数据库时PostgreSQL发出错误信息:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># DROP DATABASE testdb1;</span></span><br><span class="line">错误:  其他用户正在使用数据库 <span class="string">"testdb1"</span></span><br><span class="line">DETAIL:  那里有1个其它会话正在使用数据库.</span><br></pre></td></tr></table></figure>
<ul>
<li>首先，查询pg_stat_activity视图以查找针对testdb1数据库正在发生的活动:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># SELECT</span></span><br><span class="line">   *</span><br><span class="line">FROM</span><br><span class="line">   pg_stat_activity</span><br><span class="line">WHERE</span><br><span class="line">   datname = <span class="string">'testdb1'</span>;</span><br><span class="line"> datid | datname |  pid  | usesysid | usename | application_name |   client_addr   | client_hostname | client_port |         backend_start         | xact_start | query_start |         state_change          | wait_event_type | wait_event | state | backend_xid | backend_xmin | query |  backend_type</span><br><span class="line">-------+---------+-------+----------+---------+------------------+-----------------+-----------------+-------------+-------------------------------+------------+-------------+-------------------------------+-----------------+------------+-------+-------------+--------------+-------+----------------</span><br><span class="line"> 17730 | testdb1 | 79644 |    16384 | <span class="built_in">test</span>    | psql             | 192.168.100.133 |                 |       41834 | 2019-11-27 12:14:49.143804+08 |            |             | 2019-11-27 12:14:49.160428+08 | Client          | ClientRead | idle  |             |              |       | client backend</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<ul>
<li>终止与数据库的连接</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># SELECT</span></span><br><span class="line">   pg_terminate_backend (pg_stat_activity.pid)</span><br><span class="line">FROM</span><br><span class="line">   pg_stat_activity</span><br><span class="line">WHERE</span><br><span class="line">   pg_stat_activity.datname = <span class="string">'testdb1'</span>;</span><br><span class="line"> pg_terminate_backend</span><br><span class="line">----------------------</span><br><span class="line"> t</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<ul>
<li>使用DROP DATABASE命令删除testdb1数据库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># DROP DATABASE testdb1;</span></span><br><span class="line">DROP DATABASE</span><br></pre></td></tr></table></figure>
<h3 id="复制数据库"><a href="#复制数据库" class="headerlink" title="复制数据库"></a>复制数据库</h3><h4 id="复制同一服务器内的数据库"><a href="#复制同一服务器内的数据库" class="headerlink" title="复制同一服务器内的数据库"></a>复制同一服务器内的数据库</h4><blockquote>
<p>通过CREATE DATABASE语句来进行复制</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE targetdb </span><br><span class="line">WITH TEMPLATE sourcedb;</span><br></pre></td></tr></table></figure>
<ul>
<li>该语句将sourcedb数据库复制到targetdb数据库。</li>
</ul>
<blockquote>
<p>将test数据库复制到newtest数据库</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># CREATE DATABASE newtest </span></span><br><span class="line">WITH TEMPLATE <span class="built_in">test</span>;</span><br><span class="line">CREATE DATABASE</span><br></pre></td></tr></table></figure>
<h4 id="将数据库从服务器复制到另一个服务器"><a href="#将数据库从服务器复制到另一个服务器" class="headerlink" title="将数据库从服务器复制到另一个服务器"></a>将数据库从服务器复制到另一个服务器</h4><blockquote>
<p>这里将源数据库转储到文件中，然后将文件复制到远程服务器上并进行还原。</p>
</blockquote>
<h5 id="复制步骤"><a href="#复制步骤" class="headerlink" title="复制步骤"></a>复制步骤</h5><ul>
<li>首先，将源数据库转储到文件中。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_dump -U postgres -O sourcedb sourcedb.sql</span><br></pre></td></tr></table></figure>
<ul>
<li>其次，将转储文件复制到远程服务器。</li>
</ul>
<ul>
<li>第三，在远程服务器上创建一个新数据库:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE targetdb;</span><br></pre></td></tr></table></figure>
<ul>
<li>第四，还原远程服务器上的转储文件:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -U postgres -d targetdb -f sourcedb.sql</span><br></pre></td></tr></table></figure>
<h5 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h5><blockquote>
<p>将test数据库从本地服务器复制到remote服务器</p>
</blockquote>
<ul>
<li>首先，将test数据库转储到备份文件中，例如test.sql</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pg_dump -U postgres -d test -f test.sql</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>pg_dump把一个数据库转储为纯文本文件或者是其它格式，-U 指定数据库用户名，-d 指定需要备份的数据库，-f 指定输出备份文件的文件名或路径。</p>
</blockquote>
<ul>
<li>其次，将备份文件复制到remote服务器</li>
</ul>
<ul>
<li>第三，在remote服务器上创建test数据库:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="comment"># CREATE DATABASE test;</span></span><br><span class="line">CREATE DATABASE</span><br></pre></td></tr></table></figure>
<ul>
<li>第四，还原remote服务器中的test.sql:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># psql -U postgres -d test -f test.sql</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果服务器之间的连接速度很快并且数据库文件不大，则可以使用以下命令:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># psql -h 192.168.100.128 -p 32271 -U postgres -d test -f test.sql</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>-h 指定remote服务器IP，-p 指定其数据库端口，-U 指定数据库用户名，-d 指定数据库，-f 指定备份文件路径。</p>
</blockquote>
<h3 id="获取数据库对象大小"><a href="#获取数据库对象大小" class="headerlink" title="获取数据库对象大小"></a>获取数据库对象大小</h3><h4 id="PostgreSQL表大小"><a href="#PostgreSQL表大小" class="headerlink" title="PostgreSQL表大小"></a>PostgreSQL表大小</h4><blockquote>
<p>要获取特定表的大小，请使用pg_relation_size()函数</p>
</blockquote>
<ul>
<li>在test数据库中获取film表的大小</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># select pg_relation_size('film');</span></span><br><span class="line"> pg_relation_size</span><br><span class="line">------------------</span><br><span class="line">           442368</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>该pg_relation_size()函数以字节为单位返回特定表的大小。</p>
</blockquote>
<blockquote>
<p>为了使结果更易于阅读，可以使用pg_size_pretty()函数。该pg_size_pretty()函数采用另一个函数的结果，并根据需要使用字节，KB，MB，GB或TB对其进行格式化。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    pg_size_pretty (pg_relation_size(<span class="string">'film'</span>));</span><br><span class="line"> pg_size_pretty</span><br><span class="line">----------------</span><br><span class="line"> 432 kB</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>该pg_relation_size()函数仅返回表的大小，不包括索引或其他对象。</p>
</blockquote>
<blockquote>
<p>要获取表的总大小，请使用pg_total_relation_size()函数。</p>
</blockquote>
<ul>
<li>获取film表的总大小</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    pg_size_pretty (</span><br><span class="line">        pg_total_relation_size (<span class="string">'film'</span>)</span><br><span class="line">    );</span><br><span class="line"> pg_size_pretty</span><br><span class="line">----------------</span><br><span class="line"> 688 kB</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<ul>
<li>查询test数据库中的前5个最大表</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    relname AS <span class="string">"relation"</span>,</span><br><span class="line">    pg_size_pretty (</span><br><span class="line">        pg_total_relation_size (C .oid)</span><br><span class="line">    ) AS <span class="string">"total_size"</span></span><br><span class="line">FROM</span><br><span class="line">    pg_class C</span><br><span class="line">LEFT JOIN pg_namespace N ON (N.oid = C .relnamespace)</span><br><span class="line">WHERE</span><br><span class="line">    nspname NOT IN (</span><br><span class="line">        <span class="string">'pg_catalog'</span>,</span><br><span class="line">        <span class="string">'information_schema'</span></span><br><span class="line">    )</span><br><span class="line">AND C .relkind &lt;&gt; <span class="string">'i'</span></span><br><span class="line">AND nspname !~ <span class="string">'^pg_toast'</span></span><br><span class="line">ORDER BY</span><br><span class="line">    pg_total_relation_size (C .oid) DESC</span><br><span class="line">LIMIT 5;</span><br><span class="line">  relation  | total_size</span><br><span class="line">------------+------------</span><br><span class="line"> rental     | 2472 kB</span><br><span class="line"> payment    | 2232 kB</span><br><span class="line"> film       | 688 kB</span><br><span class="line"> film_actor | 536 kB</span><br><span class="line"> inventory  | 464 kB</span><br><span class="line">(5 rows)</span><br></pre></td></tr></table></figure>
<h4 id="PostgreSQL数据库大小"><a href="#PostgreSQL数据库大小" class="headerlink" title="PostgreSQL数据库大小"></a>PostgreSQL数据库大小</h4><blockquote>
<p>要获取整个数据库的大小，请使用pg_database_size()函数。</p>
</blockquote>
<ul>
<li>查询test数据库的大小</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    pg_size_pretty (</span><br><span class="line">        pg_database_size (<span class="string">'test'</span>)</span><br><span class="line">    );</span><br><span class="line"> pg_size_pretty</span><br><span class="line">----------------</span><br><span class="line"> 17 MB</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<ul>
<li>获取当前数据库服务器中每个数据库的大小</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    pg_database.datname,</span><br><span class="line">    pg_size_pretty(pg_database_size(pg_database.datname)) AS size</span><br><span class="line">    FROM pg_database;</span><br><span class="line">  datname  |  size</span><br><span class="line">-----------+---------</span><br><span class="line"> postgres  | 8193 kB</span><br><span class="line"> template1 | 8193 kB</span><br><span class="line"> template0 | 8049 kB</span><br><span class="line"> db        | 8193 kB</span><br><span class="line"> <span class="built_in">test</span>      | 17 MB</span><br><span class="line">(5 rows)</span><br></pre></td></tr></table></figure>
<h4 id="PostgreSQL索引大小"><a href="#PostgreSQL索引大小" class="headerlink" title="PostgreSQL索引大小"></a>PostgreSQL索引大小</h4><blockquote>
<p>要获取连接到表的所有索引的总大小，请使用pg_indexes_size()函数。pg_indexes_size()函数接受OID或表名作为参数，并返回该表附加的所有索引使用的总磁盘空间。</p>
</blockquote>
<ul>
<li>获取附加到film表的所有索引的总大小</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    pg_size_pretty (pg_indexes_size(<span class="string">'film'</span>));</span><br><span class="line"> pg_size_pretty</span><br><span class="line">----------------</span><br><span class="line"> 224 kB</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<h4 id="PostgreSQL表空间大小"><a href="#PostgreSQL表空间大小" class="headerlink" title="PostgreSQL表空间大小"></a>PostgreSQL表空间大小</h4><blockquote>
<p>要获取表空间的大小，请使用pg_tablespace_size()函数。该pg_tablespace_size()函数接受表空间名称，并以字节为单位返回大小。</p>
</blockquote>
<ul>
<li>以下语句返回pg_default表空间的大小:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    pg_size_pretty (</span><br><span class="line">        pg_tablespace_size (<span class="string">'pg_default'</span>)</span><br><span class="line">    );</span><br><span class="line"> pg_size_pretty</span><br><span class="line">----------------</span><br><span class="line"> 49 MB</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<h4 id="PostgreSQL值大小"><a href="#PostgreSQL值大小" class="headerlink" title="PostgreSQL值大小"></a>PostgreSQL值大小</h4><blockquote>
<p>若要查找需要存储特定值的空间，请使用pg_column_size()函数。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># select pg_column_size(5::smallint);</span></span><br><span class="line"> pg_column_size</span><br><span class="line">----------------</span><br><span class="line">              2</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>=<span class="comment"># select pg_column_size(5::int);</span></span><br><span class="line"> pg_column_size</span><br><span class="line">----------------</span><br><span class="line">              4</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>=<span class="comment"># select pg_column_size(5::bigint);</span></span><br><span class="line"> pg_column_size</span><br><span class="line">----------------</span><br><span class="line">              8</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<h2 id="管理表"><a href="#管理表" class="headerlink" title="管理表"></a>管理表</h2><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><blockquote>
<p>PostgreSQL支持以下数据类型:</p>
<ul>
<li>布尔型</li>
</ul>
<ul>
<li>字符类型，例如char，varchar和text。</li>
</ul>
<ul>
<li>数值类型，例如整数和浮点数。</li>
</ul>
<ul>
<li>时间类型，例如date, time, timestamp和interval</li>
</ul>
<ul>
<li>用于存储通用唯一标识符的UUID</li>
</ul>
<ul>
<li>用于存储数组字符串，数字等的数组</li>
</ul>
<ul>
<li>JSON存储JSON数据</li>
</ul>
<ul>
<li>hstore存储键值对</li>
</ul>
<ul>
<li>特殊类型，例如网络地址和几何数据。</li>
</ul>
</blockquote>
<h4 id="布尔型"><a href="#布尔型" class="headerlink" title="布尔型"></a>布尔型</h4><blockquote>
<p>布尔数据类型可以包含三个可能的值之一：true，false或null。您可以使用boolean或bool关键字来声明具有Boolean数据类型的列。</p>
</blockquote>
<blockquote>
<p>当您将数据插入Boolean列时，PostgreSQL将其转换为布尔值，例如1，yes，y，t，true转换为true，0，no，n false，f转换为false。</p>
</blockquote>
<blockquote>
<p>当您从布尔值列中选择数据时，PostgreSQL会将值转换回，例如，t转换为true，f转换为false，空格转换为null。</p>
</blockquote>
<h4 id="字符类型"><a href="#字符类型" class="headerlink" title="字符类型"></a>字符类型</h4><blockquote>
<p>PostgreSQL提供三种字符数据类型：CHAR(n)，VARCHAR(n)和TEXT:</p>
<ul>
<li>CHAR(n)是定长字符，带有空格。如果插入的字符串短于该列的长度，则PostgreSQL将填充空格。如果插入的字符串长于该列的长度，则PostgreSQL将发出错误。</li>
</ul>
<ul>
<li>VARCHAR(n)是长度可变的字符串。使用VARCHAR(n)，最多可以存储n个字符。当存储的字符串短于该列的长度时，PostgreSQL不填充空格。</li>
</ul>
<ul>
<li>TEXT是变长字符串。从理论上讲，文本数据是长度不受限制的字符串。</li>
</ul>
</blockquote>
<h4 id="数值类型"><a href="#数值类型" class="headerlink" title="数值类型"></a>数值类型</h4><blockquote>
<p>PostgreSQL提供两种不同的数字类型:整数和浮点数。</p>
</blockquote>
<blockquote>
<p>PostgreSQL中有三种整数:</p>
<ul>
<li>小整数(SMALLINT)是2字节有符号整数，范围为-32768到32767。</li>
</ul>
<ul>
<li>整数(INT)是一个4字节整数，范围为-2147483648至2147483647。</li>
</ul>
<ul>
<li>Serial与整数相同，PostgreSQL将自动生成值并将其填充到SERIAL列中。这类似于MySQL中的AUTO_INCREMENT列或SQLite中的AUTOINCREMENT列。</li>
</ul>
</blockquote>
<blockquote>
<p>有三种主要类型的浮点数:</p>
<ul>
<li>float(n)是一个浮点数，其精度至少为n，最大为8个字节。</li>
</ul>
<ul>
<li>real或float8是一个4字节的浮点数。</li>
</ul>
<ul>
<li>numeric或numeric(p,s)是p位的小数点后为s的实数。数字(p,s)是确切的数字。</li>
</ul>
</blockquote>
<h4 id="时间类型"><a href="#时间类型" class="headerlink" title="时间类型"></a>时间类型</h4><blockquote>
<p>PostgreSQL有五种主要的时间数据类型:</p>
<ul>
<li>DATE仅存储日期。</li>
</ul>
<ul>
<li>TIME存储一天中的时间值。</li>
</ul>
<ul>
<li>TIMESTAMP同时存储日期和时间值。</li>
</ul>
<ul>
<li>TIMESTAMPTZ是可识别时区的时间戳数据类型。这是带有时区的时间戳的缩写。</li>
</ul>
<ul>
<li>INTERVAL存储时间段。<br>TIMESTAMPTZ是PostgreSQL对SQL标准的时态数据类型的扩展。</li>
</ul>
</blockquote>
<h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><blockquote>
<p>在PostgreSQL中，您可以在数组列中存储字符串数组，整数数组等。如，存储一周中的某几天，一年中的几个月。</p>
</blockquote>
<h4 id="JSON格式"><a href="#JSON格式" class="headerlink" title="JSON格式"></a>JSON格式</h4><blockquote>
<p>PostgreSQL提供两种JSON数据类型:JSON和JSONB，用于存储JSON数据。</p>
</blockquote>
<blockquote>
<p>JSON数据类型存储需要为每个处理重新解析的纯JSON数据，而JSONB数据类型以二进制格式存储JSON数据，该二进制格式处理速度更快，但插入速度较慢。另外，JSONB支持索引编制，这可能是一个优势。</p>
</blockquote>
<h4 id="UUID"><a href="#UUID" class="headerlink" title="UUID"></a>UUID</h4><blockquote>
<p>UUID数据类型允许您存储RFC 4122定义的通用唯一标识符。与SERIAL相比，UUID值可确保更好的唯一性，并且可用于隐藏向公众公开的敏感数据，例如URL中的id值。</p>
</blockquote>
<h4 id="特殊数据类型"><a href="#特殊数据类型" class="headerlink" title="特殊数据类型"></a>特殊数据类型</h4><blockquote>
<p>除原始数据类型外，PostgreSQL还提供了几种与几何和网络有关的特殊数据类型:</p>
<ul>
<li>box – 一个矩形框。</li>
</ul>
<ul>
<li>line – 一组点。</li>
</ul>
<ul>
<li>point – 几何数字对。</li>
</ul>
<ul>
<li>lseg – 线段。</li>
</ul>
<ul>
<li>polygon – 封闭的几何图形。</li>
</ul>
<ul>
<li>inet – IP4地址。</li>
</ul>
<ul>
<li>macaddr – MAC地址。</li>
</ul>
</blockquote>
<h3 id="CREATE-TABLE语句"><a href="#CREATE-TABLE语句" class="headerlink" title="CREATE TABLE语句"></a>CREATE TABLE语句</h3><blockquote>
<p>要在PostgreSQL中创建新表，请使用CREATE TABLE语句。</p>
</blockquote>
<h4 id="CREATE-TABLE语法"><a href="#CREATE-TABLE语法" class="headerlink" title="CREATE TABLE语法"></a>CREATE TABLE语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name (</span><br><span class="line">   column_name TYPE column_constraint,</span><br><span class="line">   table_constraint table_constraint</span><br><span class="line">) INHERITS existing_table_name;</span><br></pre></td></tr></table></figure>
<ul>
<li>首先，在CREATE TABLE子句之后指定新表的名称。 </li>
</ul>
<ul>
<li>接下来，列出列名称，其数据类型和列约束。一个表可能有多个以逗号(,)分隔的列。列约束定义了列的规则，例如NOT NULL。</li>
</ul>
<ul>
<li>然后，在列列表之后，定义一个表级约束，该约束定义了表中数据的规则。</li>
</ul>
<ul>
<li>之后，指定一个新表继承现有表。这意味着新表包含现有表的所有列以及CREATE TABLE语句中定义的列。这是PostgreSQL对SQL的扩展。</li>
</ul>
<h4 id="PostgreSQL列约束"><a href="#PostgreSQL列约束" class="headerlink" title="PostgreSQL列约束"></a>PostgreSQL列约束</h4><blockquote>
<p>以下是PostgreSQL中常用的列约束：</p>
<ul>
<li>NOT NULL – 列的值不能为NULL。</li>
</ul>
<ul>
<li>UNIQUE – 列的值在整个表中必须是唯一的。但是，该列可以具有许多NULL值，因为PostgreSQL将每个NULL值都视为唯一。注意，SQL标准仅在具有UNIQUE约束的列中允许一个NULL值。</li>
</ul>
<ul>
<li>PRIMARY KEY – 此约束是NOT NULL和UNIQUE约束的组合。可以使用列级约束将一列定义为PRIMARY KEY。如果主键包含多个列，则必须使用表级约束。</li>
</ul>
<ul>
<li>CHECK – 可以在插入或更新数据时检查条件。如，产品表的价格列中的值必须为正值。</li>
</ul>
<ul>
<li>REFERENCES – 约束存在于另一个表的列中的列的值。可以使用REFERENCES定义外键约束。</li>
</ul>
</blockquote>
<h4 id="PostgreSQL表约束"><a href="#PostgreSQL表约束" class="headerlink" title="PostgreSQL表约束"></a>PostgreSQL表约束</h4><blockquote>
<p>表约束与列约束类似，不同之处在于它们适用于整个表而不是单个列。以下是表约束：</p>
<ul>
<li>UNIQUE(column_list) – 强制存储在括号内列出的列中的值唯一。</li>
</ul>
<ul>
<li>PRIMARY KEY(column_list) – 定义由多个列组成的主键。</li>
</ul>
<ul>
<li>CHECK(condition) – 在插入或更新数据时检查条件。</li>
</ul>
<ul>
<li>REFERENCES – 限制存储在另一表的列中必须存在的列中的值。</li>
</ul>
</blockquote>
<h4 id="CREATE-TABLE示例1"><a href="#CREATE-TABLE示例1" class="headerlink" title="CREATE TABLE示例1"></a>CREATE TABLE示例1</h4><blockquote>
<p>创建一个名为account的表，该表具有以下带有相应约束的列:</p>
<ul>
<li>user_id – 主键</li>
</ul>
<ul>
<li>用户名 – 唯一且不为空</li>
</ul>
<ul>
<li>密码 – 不为空</li>
</ul>
<ul>
<li>电子邮件 – 唯一且不为空</li>
</ul>
<ul>
<li>created_on – 不为空</li>
</ul>
<ul>
<li>last_login – 可为空</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE account(</span></span><br><span class="line">   user_id serial PRIMARY KEY,</span><br><span class="line">   username VARCHAR (50) UNIQUE NOT NULL,</span><br><span class="line">   password VARCHAR (50) NOT NULL,</span><br><span class="line">   email VARCHAR (355) UNIQUE NOT NULL,</span><br><span class="line">   created_on TIMESTAMP NOT NULL,</span><br><span class="line">   last_login TIMESTAMP</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<h4 id="CREATE-TABLE示例2"><a href="#CREATE-TABLE示例2" class="headerlink" title="CREATE TABLE示例2"></a>CREATE TABLE示例2</h4><blockquote>
<p>创建一个名为role的表，其由两列组成:role_id和role_name。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE role(</span></span><br><span class="line">   role_id serial PRIMARY KEY,</span><br><span class="line">   role_name VARCHAR (255) UNIQUE NOT NULL</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<h4 id="CREATE-TABLE示例3"><a href="#CREATE-TABLE示例3" class="headerlink" title="CREATE TABLE示例3"></a>CREATE TABLE示例3</h4><blockquote>
<p>创建名为account_roles的表，其有三列组成:user_id，role_id和grant_date。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE account_role</span></span><br><span class="line">(</span><br><span class="line">  user_id <span class="built_in">integer</span> NOT NULL,</span><br><span class="line">  role_id <span class="built_in">integer</span> NOT NULL,</span><br><span class="line">  grant_date timestamp without time zone,</span><br><span class="line">  PRIMARY KEY (user_id, role_id),</span><br><span class="line">  CONSTRAINT account_role_role_id_fkey FOREIGN KEY (role_id)</span><br><span class="line">      REFERENCES role (role_id) MATCH SIMPLE</span><br><span class="line">      ON UPDATE NO ACTION ON DELETE NO ACTION,</span><br><span class="line">  CONSTRAINT account_role_user_id_fkey FOREIGN KEY (user_id)</span><br><span class="line">      REFERENCES account (user_id) MATCH SIMPLE</span><br><span class="line">      ON UPDATE NO ACTION ON DELETE NO ACTION</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>该 account_role 表的主键由两列组成：user_id 和role_id。</p>
<ul>
<li>使用主键表级约束来定义主键: PRIMARY KEY (user_id, role_id)</li>
</ul>
<ul>
<li>因为user_id列引用了account表中的user_id列，所以需要为user_id列定义外键约束：</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONSTRAINT account_role_user_id_fkey FOREIGN KEY (user_id)</span><br><span class="line">      REFERENCES account (user_id) MATCH SIMPLE</span><br><span class="line">      ON UPDATE NO ACTION ON DELETE NO ACTION</span><br></pre></td></tr></table></figure>
<ul>
<li>role_id列引用role表中的role_id列，还需要为该role_id列定义外键约束:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONSTRAINT account_role_role_id_fkey FOREIGN KEY (role_id)</span><br><span class="line">      REFERENCES role (role_id) MATCH SIMPLE</span><br><span class="line">      ON UPDATE NO ACTION ON DELETE NO ACTION,</span><br></pre></td></tr></table></figure>
<h3 id="SELECT-INTO语句"><a href="#SELECT-INTO语句" class="headerlink" title="SELECT INTO语句"></a>SELECT INTO语句</h3><blockquote>
<p>SELECT INTO语句允许创建一个新表并插入查询返回的数据。新表列具有与SELECT子句的输出列关联的名称和数据类型。与SELECT语句不同，SELECT INTO语句不会将数据返回给客户端。</p>
</blockquote>
<h4 id="SELECT-INTO语句语法"><a href="#SELECT-INTO语句语法" class="headerlink" title="SELECT INTO语句语法"></a>SELECT INTO语句语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    column_list</span><br><span class="line">INTO [ TEMPORARY | TEMP | UNLOGGED ] [ TABLE ] new_table_name</span><br><span class="line">FROM</span><br><span class="line">    table_name</span><br><span class="line">WHERE</span><br><span class="line">    condition;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要创建具有从结果集中派生的结构和数据的新表，请在INTO子句中指定新表名。</p>
</blockquote>
<blockquote>
<p>TEMP或TEMPORARY关键字是可选的； 它允许您创建一个临时表。</p>
</blockquote>
<blockquote>
<p>UNLOGGED关键字（如果可用）将使新表成为未记录表。</p>
</blockquote>
<blockquote>
<p>WHERE子句允许您从原始表中指定应插入新表中的数据。除了WHERE子句外，还可以将SELECT语句中的其他子句用于SELECT INTO语句，例如INNER JOIN，LEFT JOIN，GROUP BY和HAVING。</p>
</blockquote>
<blockquote>
<p>请注意，您不能在PL / pgSQL或ECPG中使用SELECT INTO语句，因为它们对INTO子句的解释不同。在这种情况下，可以使用CREATE TABLE AS语句，该语句比SELECT INTO语句提供更多的功能。</p>
</blockquote>
<h4 id="SELECT-INTO示例1"><a href="#SELECT-INTO示例1" class="headerlink" title="SELECT INTO示例1"></a>SELECT INTO示例1</h4><blockquote>
<p>创建一个名为film_r的新表且该表包含所有评级为R且租期大于5天的film表中的电影</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    film_id,</span><br><span class="line">    title,</span><br><span class="line">    rental_rate</span><br><span class="line">INTO TABLE film_r</span><br><span class="line">FROM</span><br><span class="line">    film</span><br><span class="line">WHERE</span><br><span class="line">    rating = <span class="string">'R'</span></span><br><span class="line">AND rental_duration = 5</span><br><span class="line">ORDER BY</span><br><span class="line">    title;</span><br><span class="line">SELECT 40</span><br></pre></td></tr></table></figure>
<blockquote>
<p>验证表的创建</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    *</span><br><span class="line">FROM</span><br><span class="line">    film_r;</span><br><span class="line"> film_id |          title          | rental_rate</span><br><span class="line">---------+-------------------------+-------------</span><br><span class="line">      54 | Banger Pinocchio        |        0.99</span><br><span class="line">     115 | Campus Remember         |        2.99</span><br><span class="line">     138 | Chariots Conspiracy     |        2.99</span><br><span class="line">     159 | Closer Bang             |        4.99</span><br><span class="line">     168 | Comancheros Enemy       |        0.99</span><br><span class="line">     246 | Doubtfire Labyrinth     |        4.99</span><br><span class="line">     287 | Entrapment Satisfaction |        0.99</span><br><span class="line">     296 | Express Lonely          |        2.99</span><br><span class="line">     310 | Fever Empire            |        4.99</span><br><span class="line">     316 | Fire Wolves             |        4.99</span><br><span class="line">     339 | Frogmen Breaking        |        0.99</span><br><span class="line">     356 | Giant Troopers          |        2.99</span><br><span class="line">     358 | Gilmore Boiled          |        0.99</span><br><span class="line">     372 | Graceland Dynamite      |        4.99</span><br><span class="line">     384 | Grosse Wonderful        |        4.99</span><br><span class="line">     406 | Haunting Pianist        |        0.99</span><br><span class="line">     427 | Homeward Cider          |        0.99</span><br><span class="line">     447 | Ice Crossing            |        2.99</span><br><span class="line">     493 | Kane Exorcist           |        0.99</span><br><span class="line">     543 | Madigan Dorado          |        4.99</span><br><span class="line">     640 | Opus Ice                |        4.99</span><br><span class="line">     686 | Pluto Oleander          |        4.99</span><br><span class="line">     707 | Quest Mussolini         |        2.99</span><br><span class="line">     724 | Remember Diary          |        2.99</span><br><span class="line">     747 | Roxanne Rebel           |        0.99</span><br><span class="line">     788 | Ship Wonderland         |        2.99</span><br><span class="line">     808 | Sling Luke              |        0.99</span><br><span class="line">     833 | Splendor Patton         |        0.99</span><br><span class="line">     838 | Stagecoach Armageddon   |        4.99</span><br><span class="line">     840 | Stampede Disturbing     |        0.99</span><br><span class="line">     856 | Streetcar Intentions    |        4.99</span><br><span class="line">     858 | Submarine Bed           |        4.99</span><br><span class="line">     863 | Sun Confessions         |        0.99</span><br><span class="line">     884 | Terminator Club         |        4.99</span><br><span class="line">     890 | Tights Dawn             |        0.99</span><br><span class="line">     935 | Vanished Garden         |        0.99</span><br><span class="line">     945 | Virginian Pluto         |        0.99</span><br><span class="line">     967 | Weekend Personal        |        2.99</span><br><span class="line">     995 | Yentl Idaho             |        4.99</span><br><span class="line">     999 | Zoolander Fiction       |        2.99</span><br><span class="line">(40 rows)</span><br></pre></td></tr></table></figure>
<h4 id="SELECT-INTO示例2"><a href="#SELECT-INTO示例2" class="headerlink" title="SELECT INTO示例2"></a>SELECT INTO示例2</h4><blockquote>
<p>创建一个名为short_film的临时表，该表包含所有长度在60分钟以下的电影。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    film_id,</span><br><span class="line">    title,</span><br><span class="line">    length</span><br><span class="line">INTO TEMP TABLE short_film</span><br><span class="line">FROM</span><br><span class="line">    film</span><br><span class="line">WHERE</span><br><span class="line">    length &lt; 60</span><br><span class="line">ORDER BY</span><br><span class="line">    title;</span><br><span class="line">SELECT 96</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">   *</span><br><span class="line">FROM</span><br><span class="line">   short_film;</span><br><span class="line"> film_id |        title         | length </span><br><span class="line">---------+----------------------+--------</span><br><span class="line">       2 | Ace Goldfinger       |     48</span><br><span class="line">       3 | Adaptation Holes     |     50</span><br><span class="line">       8 | Airport Pollock      |     54</span><br><span class="line">      15 | Alien Center         |     46</span><br><span class="line">      18 | Alter Victory        |     57</span><br><span class="line">      66 | Beneath Rush         |     53</span><br><span class="line">      83 | Blues Instinct       |     50</span><br><span class="line">      97 | Bride Intrigue       |     56</span><br><span class="line">     110 | Cabin Flash          |     53</span><br><span class="line">     111 | Caddyshack Jedi      |     52</span><br><span class="line">     134 | Champion Flatliners  |     51</span><br><span class="line">     159 | Closer Bang          |     58</span><br><span class="line">     164 | Coast Rainbow        |     55</span><br><span class="line">     171 | Commandments Express |     59</span><br><span class="line">     187 | Cranes Reservoir     |     57</span><br><span class="line">     192 | Crossing Divorce     |     50</span><br><span class="line">     199 | Cupboard Sinners     |     56</span><br><span class="line">     205 | Dances None          |     58</span><br><span class="line">     214 | Daughter Madigan     |     59</span><br><span class="line">--More--</span><br></pre></td></tr></table></figure>
<h3 id="CREATE-TABLE-AS语句"><a href="#CREATE-TABLE-AS语句" class="headerlink" title="CREATE TABLE AS语句"></a>CREATE TABLE AS语句</h3><blockquote>
<p>CREATE TABLE AS语句创建一个新表，并用查询返回的数据填充该表。</p>
</blockquote>
<h4 id="CREATE-TABLE-AS语句语法"><a href="#CREATE-TABLE-AS语句语法" class="headerlink" title="CREATE TABLE AS语句语法"></a>CREATE TABLE AS语句语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE new_table_name</span><br><span class="line">AS query;</span><br></pre></td></tr></table></figure>
<ul>
<li>首先，在CREATE TABLE子句之后指定新的表名。</li>
</ul>
<ul>
<li>其次，提供一个查询，该查询的结果集将在AS关键字之后添加到新表中。</li>
</ul>
<blockquote>
<p>TEMPORARY或TEMP关键字允许您创建一个临时表：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TEMP TABLE new_table_name</span><br><span class="line">AS query;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>UNLOGGED关键字允许将新表创建为未记录表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE UNLOGGED TABLE new_table_name</span><br><span class="line">AS query;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>新表的列将具有与SELECT子句的输出列关联的名称和数据类型。</p>
</blockquote>
<blockquote>
<p>如果希望表列具有不同的名称，则可以在新表名称之后指定新表列：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE new_table_name (column_name_list)</span><br><span class="line">AS query;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果要通过创建一个已经存在的新表来避免错误，则可以使用IF NOT EXISTS选项，如下所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS new_table_name</span><br><span class="line">AS query;</span><br></pre></td></tr></table></figure>
<h4 id="CREATE-TABLE-AS语句示例1"><a href="#CREATE-TABLE-AS语句示例1" class="headerlink" title="CREATE TABLE AS语句示例1"></a>CREATE TABLE AS语句示例1</h4><blockquote>
<p>创建一个表，其中包含类别为1的动作片</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE action_film AS</span></span><br><span class="line">SELECT</span><br><span class="line">    film_id,</span><br><span class="line">    title,</span><br><span class="line">    release_year,</span><br><span class="line">    length,</span><br><span class="line">    rating</span><br><span class="line">FROM</span><br><span class="line">    film</span><br><span class="line">INNER JOIN film_category USING (film_id)</span><br><span class="line">WHERE</span><br><span class="line">    category_id = 1 ; -- action</span><br><span class="line">SELECT 64</span><br></pre></td></tr></table></figure>
<blockquote>
<p>验证表的创建</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    *</span><br><span class="line">FROM</span><br><span class="line">    action_film</span><br><span class="line">ORDER BY</span><br><span class="line">    title;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>检查表结构</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>-&gt; \d action_film</span><br><span class="line">                   数据表 <span class="string">"public.action_film"</span></span><br><span class="line">     栏位     |          类型          | 校对规则 | 可空的 | 预设 </span><br><span class="line">--------------+------------------------+----------+--------+------</span><br><span class="line"> film_id      | <span class="built_in">integer</span>                |          |        | </span><br><span class="line"> title        | character varying(255) |          |        | </span><br><span class="line"> release_year | year                   |          |        | </span><br><span class="line"> length       | smallint               |          |        | </span><br><span class="line"> rating       | mpaa_rating            |          |        |</span><br></pre></td></tr></table></figure>
<blockquote>
<p>从输出中可以清楚地看出，action_film表的名称和数据类型是从SELECT子句的列派生的。</p>
</blockquote>
<blockquote>
<p>如果SELECT子句包含表达式，则最好重写列，如:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE IF NOT EXISTS film_rating (rating, film_count)</span></span><br><span class="line">AS</span><br><span class="line">SELECT</span><br><span class="line">    rating,</span><br><span class="line">    COUNT (film_id)</span><br><span class="line">FROM</span><br><span class="line">    film</span><br><span class="line">GROUP BY</span><br><span class="line">    rating;</span><br><span class="line">SELECT 5</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">&gt; 此语句创建了一个新表film_rating，并用表中的摘要数据填充了该film表。它显式指定了新表的列名，而不是使用SELECT子句中的列名。</span><br><span class="line"></span><br><span class="line">&gt; 检查film_rating表的结构</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line"><span class="built_in">test</span>-&gt; \d film_rating</span><br><span class="line">             数据表 <span class="string">"public.film_rating"</span></span><br><span class="line">    栏位    |    类型     | 校对规则 | 可空的 | 预设 </span><br><span class="line">------------+-------------+----------+--------+------</span><br><span class="line"> rating     | mpaa_rating |          |        | </span><br><span class="line"> film_count | bigint      |          |        |</span><br></pre></td></tr></table></figure>
<blockquote>
<p>请注意，CREATE TABLE AS语句类似于SELECT INTO语句，但是首选CREATE TABLE AS语句，因为它不会与PL/pgSQL中的SELECT INTO语法的其他用法混淆。另外，CREATE TABLE AS语句提供了SELECT INTO语句提供的功能的超集。</p>
</blockquote>
<h3 id="使用PostgreSQL-SERIAL创建自动增量列"><a href="#使用PostgreSQL-SERIAL创建自动增量列" class="headerlink" title="使用PostgreSQL SERIAL创建自动增量列"></a>使用PostgreSQL SERIAL创建自动增量列</h3><blockquote>
<p>在PostgreSQL中，序列是一种特殊的数据库对象，它生成整数序列。序列通常用作表中的主键列。</p>
</blockquote>
<h4 id="SERIAL-pseudo-type-语法"><a href="#SERIAL-pseudo-type-语法" class="headerlink" title="SERIAL pseudo-type 语法"></a>SERIAL pseudo-type 语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name(</span><br><span class="line">    id SERIAL</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过将SERIAL伪类型分配给id列，PostgreSQL执行以下操作:</p>
<ul>
<li>首先，创建一个序列对象，并将该序列生成的下一个值设置为该列的默认值。</li>
</ul>
<ul>
<li>其次，将id列添加为NOT NULL约束，因为序列始终会生成一个整数，该整数是非null值。</li>
</ul>
<ul>
<li>第三，将序列的所有者分配给id列；结果，当删除id列或表时，将删除序列对象。</li>
</ul>
</blockquote>
<blockquote>
<p>以下语句:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name(</span><br><span class="line">    id SERIAL</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>等效于以下语句:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE SEQUENCE table_name_id_seq;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE table_name (</span><br><span class="line">    id <span class="built_in">integer</span> NOT NULL DEFAULT nextval(<span class="string">'table_name_id_seq'</span>)</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line">ALTER SEQUENCE table_name_id_seq</span><br><span class="line">OWNED BY table_name.id;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PostgreSQL提供了三个串行伪类型SMALLSERIAL，SERIAL以及BIGSERIAL:</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:center">储存空间</th>
<th style="text-align:right">范围</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SMALLSERIAL</td>
<td style="text-align:center">2 bytes</td>
<td style="text-align:right">1 至 32767</td>
</tr>
<tr>
<td style="text-align:left">SERIAL</td>
<td style="text-align:center">4 bytes</td>
<td style="text-align:right">1 至 2147483647</td>
</tr>
<tr>
<td style="text-align:left">BIGSERIAL</td>
<td style="text-align:center">8 bytes</td>
<td style="text-align:right">1 至 9223372036854775807</td>
</tr>
</tbody>
</table>
<h4 id="SERIAL范例1"><a href="#SERIAL范例1" class="headerlink" title="SERIAL范例1"></a>SERIAL范例1</h4><blockquote>
<p>注意，SERIAL不会在列上隐式创建索引或使该列成为主键列。但是，这可以通过PRIMARY KEY为SERIAL列指定约束来轻松完成。</p>
</blockquote>
<blockquote>
<p>以下语句使用id列作为SERIAL列创建fruits表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE fruits(</span></span><br><span class="line">   id SERIAL PRIMARY KEY,</span><br><span class="line">   name VARCHAR NOT NULL</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要在向表中插入行时为串行列分配默认值，请忽略列名或在INSERT语句中使用DEFAULT关键字。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO fruits(name)</span></span><br><span class="line">VALUES(<span class="string">'Orange'</span>);</span><br><span class="line">INSERT 0 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要么</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO fruits(id,name)</span></span><br><span class="line">VALUES(DEFAULT,<span class="string">'Apple'</span>);</span><br><span class="line">INSERT 0 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PostgreSQL在fruits表中插入了两行，其中id列的值为1和2。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT * FROM fruits;</span></span><br><span class="line"> id |  name</span><br><span class="line">----+--------</span><br><span class="line">  1 | Orange</span><br><span class="line">  2 | Apple</span><br><span class="line">(2 rows)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要获取SERIAL表中列的序列名称，请使用pg_get_serial_sequence()函数:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_get_serial_sequence(<span class="string">'table_name'</span>,<span class="string">'column_name'</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以将序列名称传递给currval()函数，以获取该序列生成的最新值。例如，以下语句返回由fruits_id_seq对象生成的最近值:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT currval(pg_get_serial_sequence('fruits', 'id'));</span></span><br><span class="line"> currval</span><br><span class="line">---------</span><br><span class="line">       2</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果要在表中插入新行时获取序列生成的值，请在INSERT语句中使用RETURNING id子句。以下语句在fruits表中插入新行，并返回为id列生成的值:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO fruits(name)</span></span><br><span class="line">VALUES(<span class="string">'Banana'</span>)</span><br><span class="line">RETURNING id;</span><br><span class="line"> id</span><br><span class="line">----</span><br><span class="line">  3</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line">INSERT 0 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>序列生成器操作不是事务安全的。这意味着，如果两个并发数据库连接尝试从序列中获取下一个值，则每个客户端将获得一个不同的值。如果一个客户端回滚该事务，则该客户端的序列号将不被使用，从而在序列中产生间隙。</p>
</blockquote>
<h3 id="CREATE-SEQUENCE语句"><a href="#CREATE-SEQUENCE语句" class="headerlink" title="CREATE SEQUENCE语句"></a>CREATE SEQUENCE语句</h3><blockquote>
<p>PostgreSQL中的序列是用户定义的模式绑定对象，该对象根据指定的规范生成整数序列。要在PostgreSQL中创建序列，请使用CREATE SEQUENCE语句。</p>
</blockquote>
<h4 id="CREATE-SEQUENCE语句语法"><a href="#CREATE-SEQUENCE语句语法" class="headerlink" title="CREATE SEQUENCE语句语法"></a>CREATE SEQUENCE语句语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE SEQUENCE [ IF NOT EXISTS ] sequence_name</span><br><span class="line">    [ AS &#123; SMALLINT | INT | BIGINT &#125; ]</span><br><span class="line">    [ INCREMENT [ BY ] increment ]</span><br><span class="line">    [ MINVALUE minvalue | NO MINVALUE ]</span><br><span class="line">    [ MAXVALUE maxvalue | NO MAXVALUE ]</span><br><span class="line">    [ START [ WITH ] start ]</span><br><span class="line">    [ CACHE cache ]</span><br><span class="line">    [ [ NO ] CYCLE ]</span><br><span class="line">    [ OWNED BY &#123; table_name.column_name | NONE &#125; ]</span><br></pre></td></tr></table></figure>
<ul>
<li>sequence_name : 在CREATE SEQUENCE子句之后指定序列的名称。IF NOT EXISTS仅在不存在时才有条件地创建一个新序列。序列名称必须与同一架构中的任何其他序列、表、索引、视图或外部表不同。</li>
</ul>
<ul>
<li>[AS {SMALLINT | INT | BIGINT}]: 指定序列的数据类型。有效数据类型为SMALLINT，INT和BIGINT。默认数据类型，则为BIGINT。序列的数据类型，用于确定序列的最小值和最大值。</li>
</ul>
<ul>
<li>[ INCREMENT [ BY ] increment ]<br>: 增量指定将哪个值添加到当前序列值以创建新值。一个正数将形成一个升序，而一个负数将形成一个降序。默认增量值为1。</li>
</ul>
<ul>
<li>[ MINVALUE minvalue | NO MINVALUE ]</li>
</ul>
<ul>
<li>[ MAXVALUE maxvalue | NO MAXVALUE ]:<br>定义序列的最小值和最大值。如果使用NO MINVALUE和NO MAXVALUE，则序列将使用默认值。对于升序序列，缺省最大值是序列数据类型的最大值，缺省最小值是1。如果是降序序列，则默认最大值为-1，默认最小值为序列数据类型的最小值。</li>
</ul>
<ul>
<li>[ START [ WITH ] start ]:<br>START子句指定序列的起始值。缺省的起始值为升序的最小值和降序的最大值。</li>
</ul>
<ul>
<li>cache:<br>CACHE确定要预分配多少序列号并将其存储在内存中，以加快访问速度。 一次可以生成一个值。默认情况下，该序列一次生成一个值，即不生成缓存。</li>
</ul>
<ul>
<li>CYCLE | NO CYCLE:<br>如果达到限制，则可以使用CYCLE重新启动该值。下一个数字将是升序的最小值，是降序的最大值。如果使用NO CYCLE，则在达到限制时，尝试获取下一个值将导致错误。如果您未明确指定CYCLE或NO CYCLE，则默认为NO CYCLE。</li>
</ul>
<ul>
<li>OWNED BY table_name.column_name:<br>OWNED BY子句允许将表列与序列关联，以便在删除列或表时，PostgreSQL将自动删除关联的序列。注意，当对表的列使用SERIAL伪类型时，在后台，PostgreSQL会自动创建与该列关联的序列。</li>
</ul>
<h4 id="创建升序序列示例"><a href="#创建升序序列示例" class="headerlink" title="创建升序序列示例"></a>创建升序序列示例</h4><blockquote>
<p>使用CREATE SEQUENCE语句创建一个新的升序序列，从100开始，增量为5:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE SEQUENCE mysequence</span></span><br><span class="line">INCREMENT 5</span><br><span class="line">START 100;</span><br><span class="line">CREATE SEQUENCE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要从序列中获取下一个值，请使用nextval()函数</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT nextval('mysequence');</span></span><br><span class="line"> nextval</span><br><span class="line">---------</span><br><span class="line">     100</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果再次执行该语句，将从序列中获取下一个值:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT nextval('mysequence');</span></span><br><span class="line"> nextval</span><br><span class="line">---------</span><br><span class="line">     105</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<h4 id="创建一个降序示例"><a href="#创建一个降序示例" class="headerlink" title="创建一个降序示例"></a>创建一个降序示例</h4><blockquote>
<p>使用cycle选项创建从3到1的降序序列</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE SEQUENCE three</span></span><br><span class="line">INCREMENT -1</span><br><span class="line">MINVALUE 1</span><br><span class="line">MAXVALUE 3</span><br><span class="line">START 3</span><br><span class="line">CYCLE;</span><br><span class="line">CREATE SEQUENCE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>多次执行以下语句时，您将看到数字从3、2、1开始，再回到3、2、1，依此类推:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT nextval('three');</span></span><br><span class="line"> nextval</span><br><span class="line">---------</span><br><span class="line">       3</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT nextval('three');</span></span><br><span class="line"> nextval</span><br><span class="line">---------</span><br><span class="line">       2</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT nextval('three');</span></span><br><span class="line"> nextval</span><br><span class="line">---------</span><br><span class="line">       1</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT nextval('three');</span></span><br><span class="line"> nextval</span><br><span class="line">---------</span><br><span class="line">       3</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<h4 id="创建与表列关联的序列"><a href="#创建与表列关联的序列" class="headerlink" title="创建与表列关联的序列"></a>创建与表列关联的序列</h4><blockquote>
<p>首先，创建一个名为order_details的新表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE order_details(</span></span><br><span class="line">    order_id SERIAL,</span><br><span class="line">    item_id INT NOT NULL,</span><br><span class="line">    item_text TEXT NOT NULL,</span><br><span class="line">    price DEC(10,2) NOT NULL,</span><br><span class="line">    PRIMARY KEY(order_id, item_id)</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其次，创建一个与order_details表的item_id列关联的新序列:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE SEQUENCE order_item_id</span></span><br><span class="line">START 10</span><br><span class="line">INCREMENT 10</span><br><span class="line">MINVALUE 10</span><br><span class="line">OWNED BY order_details.item_id;</span><br><span class="line">CREATE SEQUENCE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第三，将三个订单行项目插入order_details表中:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO</span></span><br><span class="line">    order_details(order_id, item_id, item_text, price)</span><br><span class="line">VALUES</span><br><span class="line">    (100, nextval(<span class="string">'order_item_id'</span>),<span class="string">'DVD Player'</span>,100),</span><br><span class="line">    (100, nextval(<span class="string">'order_item_id'</span>),<span class="string">'Android TV'</span>,550),</span><br><span class="line">    (100, nextval(<span class="string">'order_item_id'</span>),<span class="string">'Speaker'</span>,250);</span><br><span class="line">INSERT 0 3</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在此语句中，我们使用nextval()函数从order_item_id序列中获取商品ID值。</p>
</blockquote>
<blockquote>
<p>第四，从order_details表中查询数据：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    order_id,</span><br><span class="line">    item_id,</span><br><span class="line">    item_text,</span><br><span class="line">    price</span><br><span class="line">FROM</span><br><span class="line">    order_details;  </span><br><span class="line"> order_id | item_id | item_text  | price</span><br><span class="line">----------+---------+------------+--------</span><br><span class="line">      100 |      10 | DVD Player | 100.00</span><br><span class="line">      100 |      20 | Android TV | 550.00</span><br><span class="line">      100 |      30 | Speaker    | 250.00</span><br><span class="line">(3 rows)</span><br></pre></td></tr></table></figure>
<h4 id="列出数据库中的所有序列"><a href="#列出数据库中的所有序列" class="headerlink" title="列出数据库中的所有序列"></a>列出数据库中的所有序列</h4><blockquote>
<p>要列出当前数据库中的所有序列，请使用以下查询:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    relname sequence_name</span><br><span class="line">FROM</span><br><span class="line">    pg_class</span><br><span class="line">WHERE</span><br><span class="line">    relkind = <span class="string">'S'</span>;</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line"><span class="comment">#### 删除序列</span></span><br><span class="line">&gt; 如果序列与表列相关联，则在删除表列或整个表后将自动删除该序列。否则，需要使用以下DROP SEQUENCE语句手动删除序列。</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">DROP SEQUENCE [ IF EXISTS ] sequence_name [, ...]</span><br><span class="line">[ CASCADE | RESTRICT ];</span><br></pre></td></tr></table></figure>
<ul>
<li>首先，指定要删除的序列的名称。IF EXISTS选项有条件地删除该序列（如果存在）。如果要一次删除多个序列，则可以使用逗号分隔的序列名称列表。</li>
</ul>
<ul>
<li>然后，如果要自动删除依赖于序列的对象以及依赖于那些对象的对象，请使用CASCADE选项。</li>
</ul>
<h4 id="DROP-SEQUENCE语句示例"><a href="#DROP-SEQUENCE语句示例" class="headerlink" title="DROP SEQUENCE语句示例"></a>DROP SEQUENCE语句示例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># DROP TABLE order_details;</span></span><br><span class="line">DROP TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>该语句删除表order_details。由于序列order_item_id与order_details的item_id相关联，因此它也将自动删除。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># DROP SEQUENCE IF EXISTS mysequence, three;</span></span><br><span class="line">DROP SEQUENCE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>本示例使用DROP SEQUENCE语句删除两个序列mysequence和three。</p>
</blockquote>
<h3 id="GENERATED-AS-IDENTITY约束"><a href="#GENERATED-AS-IDENTITY约束" class="headerlink" title="GENERATED AS IDENTITY约束"></a>GENERATED AS IDENTITY约束</h3><blockquote>
<p>GENERATED AS IDENTITY约束使您可以自动为列分配唯一值。GENERATED AS IDENTITY约束是PostgreSQL的SERIAL列的符合SQL标准的变体。</p>
</blockquote>
<h4 id="GENERATED-AS-IDENTITY约束的语法"><a href="#GENERATED-AS-IDENTITY约束的语法" class="headerlink" title="GENERATED AS IDENTITY约束的语法"></a>GENERATED AS IDENTITY约束的语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">column_name <span class="built_in">type</span> GENERATED &#123; ALWAYS | BY DEFAULT &#125; AS IDENTITY[ ( sequence_option ) ]</span><br></pre></td></tr></table></figure>
<ul>
<li>类型可以是SMALLINT、INT或BIGINT。</li>
</ul>
<ul>
<li>GENERATED ALWAYS始终指示PostgreSQL为identity列始终生成一个值。如果您尝试将值插入（或更新）到“ GENERATED ALWAYS AS IDENTITY”列中，则PostgreSQL将发出错误消息。</li>
</ul>
<ul>
<li>GENERATED BY DEFAULT还指示PostgreSQL为Identity列生成一个值。但是，如果您提供用于插入或更新的值，则PostgreSQL将使用该值插入到Identity列中，而不是使用系统生成的值。PostgreSQL允许您在一个表中具有多个标识列。与SERIAL约束类似，GENERATED AS IDENTITY约束在内部也使用SEQUENCE对象。</li>
</ul>
<h4 id="GENERATED-ALWAYS示例"><a href="#GENERATED-ALWAYS示例" class="headerlink" title="GENERATED ALWAYS示例"></a>GENERATED ALWAYS示例</h4><blockquote>
<p>首先，创建一个名为color的表，并将color_id作为标识列:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE color (</span></span><br><span class="line">    color_id INT GENERATED ALWAYS AS IDENTITY,</span><br><span class="line">    color_name VARCHAR NOT NULL</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其次，在color表中插入新行:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO color (color_name)</span></span><br><span class="line">VALUES</span><br><span class="line">    (<span class="string">'Red'</span>);</span><br><span class="line">INSERT 0 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>因为color_id列具有GENERATED AS IDENTITY约束，所以PostgreSQL为其生成一个值，如下面的查询所示:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    *</span><br><span class="line">FROM</span><br><span class="line">    color;</span><br><span class="line"> color_id | color_name</span><br><span class="line">----------+------------</span><br><span class="line">        1 | Red</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第三，通过为color_id和color_name列提供值来插入新行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO color (color_id, color_name)</span></span><br><span class="line">VALUES</span><br><span class="line">    (2, <span class="string">'Green'</span>);</span><br><span class="line">错误:  无法插入到列<span class="string">"color_id"</span></span><br><span class="line">DETAIL:  列<span class="string">"color_id"</span>是定义为GENERATED ALWAYS的标识列.</span><br><span class="line">HINT:  使用OVERRIDING SYSTEM VALUE覆盖.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要解决此错误，在这种情况下，可以使用OVERRIDING SYSTEM VALUE子句:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO color (color_id, color_name)</span></span><br><span class="line">OVERRIDING SYSTEM VALUE</span><br><span class="line">VALUES</span><br><span class="line">    (2, <span class="string">'Green'</span>);</span><br><span class="line">INSERT 0 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>或改用GENERATED BY DEFAULT AS IDENTITY。</p>
</blockquote>
<h4 id="GENERATED-BY-DEFAULT-AS-IDENTITY示例"><a href="#GENERATED-BY-DEFAULT-AS-IDENTITY示例" class="headerlink" title="GENERATED BY DEFAULT AS IDENTITY示例"></a>GENERATED BY DEFAULT AS IDENTITY示例</h4><blockquote>
<p>首先，删除color表并重新创建它。这次，改为使用GENERATED BY DEFAULT AS IDENTITY:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># DROP TABLE color;</span></span><br><span class="line"> </span><br><span class="line">CREATE TABLE color (</span><br><span class="line">    color_id INT GENERATED BY DEFAULT AS IDENTITY,</span><br><span class="line">    color_name VARCHAR NOT NULL</span><br><span class="line">);</span><br><span class="line">DROP TABLE</span><br><span class="line"></span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第二，在color表中插入一行:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO color (color_name)</span></span><br><span class="line">VALUES</span><br><span class="line">    (<span class="string">'White'</span>);</span><br><span class="line">INSERT 0 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第三，插入另一行，并为该color_id列添加值：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO color (color_id, color_name)</span></span><br><span class="line">VALUES</span><br><span class="line">    (2, <span class="string">'Yellow'</span>);</span><br><span class="line">INSERT 0 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>与前面的示例使用GENERATED ALWAYS AS IDENTITY约束不同，此语句有效。</p>
</blockquote>
<h4 id="SEQUENCE选项示例"><a href="#SEQUENCE选项示例" class="headerlink" title="SEQUENCE选项示例"></a>SEQUENCE选项示例</h4><blockquote>
<p>由于GENERATED AS IDENTITY约束使用SEQUENCE对象，因此可以为系统生成的值指定序列选项。</p>
</blockquote>
<blockquote>
<p>指定起始值和增量，如下所示:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># DROP TABLE color;</span></span><br><span class="line"> </span><br><span class="line">CREATE TABLE color (</span><br><span class="line">    color_id INT GENERATED BY DEFAULT AS IDENTITY</span><br><span class="line">    (START WITH 10 INCREMENT BY 10),</span><br><span class="line">    color_name VARCHAR NOT NULL</span><br><span class="line">);</span><br><span class="line">DROP TABLE</span><br><span class="line"></span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在此示例中，color_id列的系统生成值以10开头，增量值为10。</p>
</blockquote>
<blockquote>
<p>首先，在color表中插入新行：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO color (color_name)</span></span><br><span class="line">VALUES</span><br><span class="line">    (<span class="string">'Orange'</span>);</span><br><span class="line">INSERT 0 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>color_id列的起始值为10，如下所示:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    *</span><br><span class="line">FROM</span><br><span class="line">    color;</span><br><span class="line"> color_id | color_name</span><br><span class="line">----------+------------</span><br><span class="line">       10 | Orange</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第二，在color表中插入另一行:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO color (color_name)</span></span><br><span class="line">VALUES</span><br><span class="line">    (<span class="string">'Purple'</span>);</span><br><span class="line">INSERT 0 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>由于增加选项，第二行的color_id的值为20。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT</span></span><br><span class="line">    *</span><br><span class="line">FROM</span><br><span class="line">    color;</span><br><span class="line"> color_id | color_name</span><br><span class="line">----------+------------</span><br><span class="line">       10 | Orange</span><br><span class="line">       20 | Purple</span><br><span class="line">(2 rows)</span><br></pre></td></tr></table></figure>
<h4 id="将标识列添加到现有表"><a href="#将标识列添加到现有表" class="headerlink" title="将标识列添加到现有表"></a>将标识列添加到现有表</h4><blockquote>
<p>可以使用以下形式的ALTER TABLE语句将标识列添加到现有表中:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">ALTER COLUMN column_name</span><br><span class="line">ADD GENERATED &#123; ALWAYS | BY DEFAULT &#125; AS IDENTITY &#123; ( sequence_option ) &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>首先，创建一个名为shape的新表:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE shape (</span></span><br><span class="line">    shape_id INT NOT NULL,</span><br><span class="line">    shape_name VARCHAR NOT NULL</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第二，将shape_id列更改为标识列:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE shape</span></span><br><span class="line">ALTER COLUMN shape_id ADD GENERATED ALWAYS AS IDENTITY;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第三，查看表结构</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; \d shape</span><br><span class="line">                                数据表 <span class="string">"public.shape"</span></span><br><span class="line">    栏位    |       类型        | 校对规则 |  可空的  |             预设             </span><br><span class="line">------------+-------------------+----------+----------+------------------------------</span><br><span class="line"> shape_id   | <span class="built_in">integer</span>           |          | not null | generated always as identity</span><br><span class="line"> shape_name | character varying |          | not null |</span><br></pre></td></tr></table></figure>
<h4 id="更改身份列"><a href="#更改身份列" class="headerlink" title="更改身份列"></a>更改身份列</h4><blockquote>
<p>可以使用ALTER TABLE语句来更改现有标识列的特征</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">ALTER COLUMN column_name</span><br><span class="line">&#123; SET GENERATED &#123; ALWAYS| BY DEFAULT &#125; |</span><br><span class="line">  SET sequence_option | RESTART [ [ WITH ] restart ] &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例如，以下语句将shape表的shape_id列更改为GENERATED BY DEFAULT:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE shape</span></span><br><span class="line">ALTER COLUMN shape_id SET GENERATED BY DEFAULT;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查看表结构</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; \d shape</span><br><span class="line">                                  数据表 <span class="string">"public.shape"</span></span><br><span class="line">    栏位    |       类型        | 校对规则 |  可空的  |               预设               </span><br><span class="line">------------+-------------------+----------+----------+----------------------------------</span><br><span class="line"> shape_id   | <span class="built_in">integer</span>           |          | not null | generated by default as identity</span><br><span class="line"> shape_name | character varying |          | not null |</span><br></pre></td></tr></table></figure>
<blockquote>
<p>从输出中可以看到，该shape_id列从GENERATED ALWAYS变为GENERATED BY DEFAULT。</p>
</blockquote>
<h4 id="除去GENERATED-AS-IDENTITY约束"><a href="#除去GENERATED-AS-IDENTITY约束" class="headerlink" title="除去GENERATED AS IDENTITY约束"></a>除去GENERATED AS IDENTITY约束</h4><blockquote>
<p>以下语句从现有表中删除GENERATED AS IDENTITY约束:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">ALTER COLUMN column_name</span><br><span class="line">DROP IDENTITY [ IF EXISTS ]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>按如下所示从shape表的shape_id列中删除GENERATED AS IDENTITY约束列：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE shape</span></span><br><span class="line">ALTER COLUMN shape_id</span><br><span class="line">DROP IDENTITY IF EXISTS;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查看表结构</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; \d shape</span><br><span class="line">                    数据表 <span class="string">"public.shape"</span></span><br><span class="line">    栏位    |       类型        | 校对规则 |  可空的  | 预设 </span><br><span class="line">------------+-------------------+----------+----------+------</span><br><span class="line"> shape_id   | <span class="built_in">integer</span>           |          | not null | </span><br><span class="line"> shape_name | character varying |          | not null |</span><br></pre></td></tr></table></figure>
<h3 id="ALTER-TABLE语句"><a href="#ALTER-TABLE语句" class="headerlink" title="ALTER TABLE语句"></a>ALTER TABLE语句</h3><blockquote>
<p>要更改现有的表结构，请使用ALTER TABLE语句。</p>
</blockquote>
<h4 id="ALTER-TABLE语法"><a href="#ALTER-TABLE语法" class="headerlink" title="ALTER TABLE语法"></a>ALTER TABLE语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name action;</span><br></pre></td></tr></table></figure>
<ul>
<li>添加列，删除列，重命名列或更改列的数据类型。</li>
</ul>
<ul>
<li>为列设置默认值。</li>
</ul>
<ul>
<li>向列添加CHECK约束。</li>
</ul>
<ul>
<li>重命名表。</li>
</ul>
<blockquote>
<p>要将新列添加到表，请使用ALTER TBLE ADD COLUMN 语句:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name ADD COLUMN new_column_name TYPE;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要删除现有列，请使用ALTER TABLE DROP COLUMN 语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name DROP COLUMN column_name;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要重命名现有列，请使用ALTER TABLE RENAME COLUMN TO 语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name RENAME COLUMN column_name TO new_column_name;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要更改列的默认值，请使用ALTER TABLE ALTER COLUMN SET DEFAULT 或 DROP DEFAULT：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name ALTER COLUMN column_name [SET DEFAULT value | DROP DEFAULT];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要更改NOT NULL约束，请使用ALTER TABLE ALTER COLUMN 语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name ALTER COLUMN column_name [SET NOT NULL| DROP NOT NULL];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要添加CHECK约束，请使用ALTER TABLE ADD CHECK 语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name ADD CHECK expression;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要添加约束，请使用ALTER TABLE ADD CONSTRAINT 语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name ADD CONSTRAINT constraint_name constraint_definition;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要重命名表，请使用ALTER TABLE RENAME TO 语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name RENAME TO new_table_name;</span><br></pre></td></tr></table></figure>
<h4 id="ALTER-TABLE示例"><a href="#ALTER-TABLE示例" class="headerlink" title="ALTER TABLE示例"></a>ALTER TABLE示例</h4><blockquote>
<p>创建一个名为links的新表，以使用ALTER TABLE语句进行练习。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE links (</span></span><br><span class="line">   link_id serial PRIMARY KEY,</span><br><span class="line">   title VARCHAR (512) NOT NULL,</span><br><span class="line">   url VARCHAR (1024) NOT NULL UNIQUE</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>添加名为active的新列</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE links ADD COLUMN active boolean;</span></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>从links表中删除active列</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE links DROP COLUMN active;</span></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将title列重命名为link_title</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE links RENAME COLUMN title TO link_title;</span></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将一个名为target的新列添加到links表中</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE links ADD COLUMN target VARCHAR(10);</span></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将_blank设置为link表中目标列的默认值</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE links ALTER COLUMN target</span></span><br><span class="line">SET DEFAULT <span class="string">'_blank'</span>;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将新行插入links表中而未指定该target列的值，则该target列将_blank作为默认值</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO links (link_title, url)</span></span><br><span class="line">VALUES(<span class="string">'PostgreSQL'</span>,<span class="string">'http://www.postgresql.org/'</span>);</span><br><span class="line">INSERT 0 1</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT * FROM links;</span></span><br><span class="line"> link_id | link_title |            url             | target</span><br><span class="line">---------+------------+----------------------------+--------</span><br><span class="line">       1 | PostgreSQL | http://www.postgresql.org/ | _blank</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>以下语句将CHECK条件添加到目标列，以便target列仅接受以下值：_self，_blank，_parent和_top：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE links ADD CHECK (target IN ('_self', '_blank', '_parent', '_top'));</span></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果尝试插入违反该列CHECK约束设置的新行target，PostgreSQL将发出错误，如下所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO links(link_title,url,target)</span></span><br><span class="line">VALUES(<span class="string">'PG'</span>,<span class="string">'http://www.postgresql.cn/'</span>,<span class="string">'pgsql'</span>);</span><br><span class="line">错误:  关系 <span class="string">"links"</span> 的新列违反了检查约束 <span class="string">"links_target_check"</span></span><br><span class="line">DETAIL:  失败, 行包含(2, PG, http://www.postgresql.cn/, pgsql).</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将links表重命名为url</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE links RENAME TO url;</span></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<h3 id="RENAME-TO子句"><a href="#RENAME-TO子句" class="headerlink" title="RENAME TO子句"></a>RENAME TO子句</h3><h4 id="重命名表语法"><a href="#重命名表语法" class="headerlink" title="重命名表语法"></a>重命名表语法</h4><blockquote>
<p>要重命名现有表，请使用以下ALTER TABLE语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">RENAME TO new_table_name;</span><br></pre></td></tr></table></figure>
<ul>
<li>首先，在ALTER TABLE子句后指定要重命名的表的名称。</li>
</ul>
<ul>
<li>其次，在RENAME TO子句后输入新的表名。</li>
</ul>
<blockquote>
<p>如果尝试重命名一个不存在的表，PostgreSQL将发出一个错误。为避免这种情况，可以IF EXISTS如下添加选项：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE IF EXISTS table_name</span><br><span class="line">RENAME TO new_table_name;</span><br></pre></td></tr></table></figure>
<ul>
<li>在这种情况下，如果table_name不存在，PostgreSQL将发出通知。</li>
</ul>
<blockquote>
<p>要重命名多个表，您必须执行多个ALTER TABLE RENAME TO语句。不可能在单个语句中做到这一点。</p>
</blockquote>
<h4 id="重命名表示例"><a href="#重命名表示例" class="headerlink" title="重命名表示例"></a>重命名表示例</h4><blockquote>
<p>创建了一个名为vendors的新表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE vendors (</span></span><br><span class="line">    id serial PRIMARY KEY,</span><br><span class="line">    name VARCHAR NOT NULL</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将vendors表重命名为suppliers</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE vendors RENAME TO suppliers;</span></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>假设vendor或supplier都属于一个组。要管理这种关系，我们需要添加supplier_groups表，如下所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE supplier_groups (</span></span><br><span class="line">    ID serial PRIMARY KEY,</span><br><span class="line">    name VARCHAR NOT NULL</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>我们还需要在Suppliers表中添加一个名为group_id的新列。此列是外键列，它链接到provider_groups表的id列。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE suppliers</span></span><br><span class="line">ADD COLUMN group_id INT NOT NULL;</span><br><span class="line"> </span><br><span class="line">ALTER TABLE suppliers</span><br><span class="line">ADD FOREIGN KEY (group_id) REFERENCES supplier_groups (ID);</span><br><span class="line">ALTER TABLE</span><br><span class="line"></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将表重命名为新表时，PostgreSQL将自动更新其依赖对象，例如外键约束，视图和索引。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; \d suppliers</span><br><span class="line">                                数据表 <span class="string">"public.suppliers"</span></span><br><span class="line">   栏位   |       类型        | 校对规则 |  可空的  |                预设                 </span><br><span class="line">----------+-------------------+----------+----------+-------------------------------------</span><br><span class="line"> id       | <span class="built_in">integer</span>           |          | not null | nextval(<span class="string">'vendors_id_seq'</span>::regclass)</span><br><span class="line"> name     | character varying |          | not null | </span><br><span class="line"> group_id | <span class="built_in">integer</span>           |          | not null | </span><br><span class="line">索引：</span><br><span class="line">    <span class="string">"vendors_pkey"</span> PRIMARY KEY, btree (id)</span><br><span class="line">外部键(FK)限制：</span><br><span class="line">    <span class="string">"suppliers_group_id_fkey"</span> FOREIGN KEY (group_id) REFERENCES supplier_groups(id)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>=&gt; ALTER TABLE supplier_groups RENAME TO groups;</span><br><span class="line">ALTER TABLE</span><br><span class="line"><span class="built_in">test</span>=&gt; \d suppliers</span><br><span class="line">                                数据表 <span class="string">"public.suppliers"</span></span><br><span class="line">   栏位   |       类型        | 校对规则 |  可空的  |                预设                 </span><br><span class="line">----------+-------------------+----------+----------+-------------------------------------</span><br><span class="line"> id       | <span class="built_in">integer</span>           |          | not null | nextval(<span class="string">'vendors_id_seq'</span>::regclass)</span><br><span class="line"> name     | character varying |          | not null | </span><br><span class="line"> group_id | <span class="built_in">integer</span>           |          | not null | </span><br><span class="line">索引：</span><br><span class="line">    <span class="string">"vendors_pkey"</span> PRIMARY KEY, btree (id)</span><br><span class="line">外部键(FK)限制：</span><br><span class="line">    <span class="string">"suppliers_group_id_fkey"</span> FOREIGN KEY (group_id) REFERENCES groups(id)</span><br></pre></td></tr></table></figure>
<h3 id="ADD-COLUMN语句"><a href="#ADD-COLUMN语句" class="headerlink" title="ADD COLUMN语句"></a>ADD COLUMN语句</h3><h4 id="ADD-COLUMN语句语法"><a href="#ADD-COLUMN语句语法" class="headerlink" title="ADD COLUMN语句语法"></a>ADD COLUMN语句语法</h4><blockquote>
<p>要将新列添加到现有表中，请使用以下语句:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">ADD COLUMN new_column_name data_type;</span><br></pre></td></tr></table></figure>
<ul>
<li>首先，在ALTER TABLE子句中指定要添加新列的表。</li>
</ul>
<ul>
<li>其次，在ADD COLUMN子句中使用其属性（例如数据类型，默认值等）指示列名称。当向表中添加新列时，PostgreSQL会将其追加到表末尾。PostgreSQL暂时无法选择指定表中新列的位置。</li>
</ul>
<blockquote>
<p>要将多个列添加到现有表中，请在ALTER TABLE语句中使用多个ADD COLUMN子句，如下所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">ADD COLUMN new_column_name_1 data_type constraint,</span><br><span class="line">ADD COLUMN new_column_name_2 data_type constraint,</span><br><span class="line">...</span><br><span class="line">ADD COLUMN new_column_name_n data_type constraint;</span><br></pre></td></tr></table></figure>
<h4 id="ADD-COLUMN示例"><a href="#ADD-COLUMN示例" class="headerlink" title="ADD COLUMN示例"></a>ADD COLUMN示例</h4><blockquote>
<p>以下CREATE TABLE语句创建一个名为customers的新表，该表具有两列：id和customer_name</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE customers (</span></span><br><span class="line">   id SERIAL PRIMARY KEY,</span><br><span class="line">   customer_name VARCHAR NOT NULL</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将phone列添加到customers表中:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE customers</span></span><br><span class="line">ADD COLUMN phone VARCHAR;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将fax和email列添加到customers表中:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE customers</span></span><br><span class="line">ADD COLUMN fax VARCHAR,</span><br><span class="line">ADD COLUMN email VARCHAR;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查看表结构</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; \d customers</span><br><span class="line">                                    数据表 <span class="string">"public.customers"</span></span><br><span class="line">     栏位      |       类型        | 校对规则 |  可空的  |                 预设                  </span><br><span class="line">---------------+-------------------+----------+----------+---------------------------------------</span><br><span class="line"> id            | <span class="built_in">integer</span>           |          | not null | nextval(<span class="string">'customers_id_seq'</span>::regclass)</span><br><span class="line"> customer_name | character varying |          | not null | </span><br><span class="line"> phone         | character varying |          |          | </span><br><span class="line"> fax           | character varying |          |          | </span><br><span class="line"> email         | character varying |          |          | </span><br><span class="line">索引：</span><br><span class="line">    <span class="string">"customers_pkey"</span> PRIMARY KEY, btree (id)</span><br></pre></td></tr></table></figure>
<h4 id="将具有NOT-NULL约束的列添加到具有数据的表中"><a href="#将具有NOT-NULL约束的列添加到具有数据的表中" class="headerlink" title="将具有NOT NULL约束的列添加到具有数据的表中"></a>将具有NOT NULL约束的列添加到具有数据的表中</h4><blockquote>
<p>插入数据</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO customers (customer_name)</span></span><br><span class="line">VALUES</span><br><span class="line">   (<span class="string">'Apple'</span>),</span><br><span class="line">   (<span class="string">'Samsung'</span>),</span><br><span class="line">   (<span class="string">'Sony'</span>);</span><br><span class="line">INSERT 0 3</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里假设将contact_name列添加到customers表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE customers</span></span><br><span class="line">ADD COLUMN contact_name VARCHAR NOT NULL;</span><br><span class="line">错误:  字段 <span class="string">"contact_name"</span> 包含空值</span><br></pre></td></tr></table></figure>
<ul>
<li>这是因为contact_name列具有NOT NULL约束。PostgreSQL添加该列时，此新列采用NULL值，这违反了NOT NULL约束。</li>
</ul>
<blockquote>
<p>为了解决这个问题，首先需要添加没有NOT NULL 约束的列。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE customers</span></span><br><span class="line">ADD COLUMN contact_name VARCHAR;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其次，更新contact_name列的值。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># UPDATE customers</span></span><br><span class="line">SET contact_name = <span class="string">'John'</span></span><br><span class="line">WHERE</span><br><span class="line">   ID = 1;</span><br><span class="line"> </span><br><span class="line">UPDATE customers</span><br><span class="line">SET contact_name = <span class="string">'Mary'</span></span><br><span class="line">WHERE</span><br><span class="line">   ID = 2;</span><br><span class="line"> </span><br><span class="line">UPDATE customers</span><br><span class="line">SET contact_name = <span class="string">'Lily'</span></span><br><span class="line">WHERE</span><br><span class="line">   ID = 3;</span><br><span class="line">UPDATE 1</span><br><span class="line"></span><br><span class="line">UPDATE 1</span><br><span class="line"></span><br><span class="line">UPDATE 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第三，为contact_name列设置NOT NULL约束。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE customers</span></span><br><span class="line">ALTER COLUMN contact_name SET NOT NULL;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<h3 id="DROP-COLUMN子句"><a href="#DROP-COLUMN子句" class="headerlink" title="DROP COLUMN子句"></a>DROP COLUMN子句</h3><h4 id="DROP-COLUMN子句的语法"><a href="#DROP-COLUMN子句的语法" class="headerlink" title="DROP COLUMN子句的语法"></a>DROP COLUMN子句的语法</h4><blockquote>
<p>要删除表的列，请在ALTER TABLE语句中使用DROP COLUMN子句，如下所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">DROP COLUMN column_name;</span><br></pre></td></tr></table></figure>
<ul>
<li>当您从表中删除列时，PostgreSQL将自动删除它与该列有关的所有索引和约束。</li>
</ul>
<blockquote>
<p>如果要删除的列已在其他数据库对象（例如视图，触发器，存储过程等）中使用，则不能删除该列，因为其他对象依赖该列。在这种情况下，将CASCADE选项添加到DROP COLUMN子句中以删除列及其所有关联对象：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">DROP COLUMN column_name CASCADE;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果删除不存在的列，PostgreSQL将发出一个错误。为避免这种情况，您可以IF EXISTS如下添加选项：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">DROP COLUMN IF EXISTS column_name;</span><br></pre></td></tr></table></figure>
<ul>
<li>在这种形式下，如果删除不存在的列，PostgreSQL将发出通知而不是错误。</li>
</ul>
<blockquote>
<p>如果要在单个命令中删除表的多个列，请使用以下语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">DROP COLUMN column_name_1,</span><br><span class="line">DROP COLUMN column_name_2,</span><br><span class="line">...;</span><br></pre></td></tr></table></figure>
<ul>
<li>请注意，每个DROP COLUMN子句都用逗号（，）分隔。</li>
</ul>
<blockquote>
<p>PostgreSQL允许删除表的唯一列，从而导致零列表，但这在SQL标准中是不允许的。</p>
</blockquote>
<h4 id="DROP-COLUMN示例"><a href="#DROP-COLUMN示例" class="headerlink" title="DROP COLUMN示例"></a>DROP COLUMN示例</h4><blockquote>
<p>创建示例表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE publishers (</span></span><br><span class="line">    publisher_id serial PRIMARY KEY,</span><br><span class="line">    name VARCHAR NOT NULL</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line">CREATE TABLE categories (</span><br><span class="line">    category_id serial PRIMARY KEY,</span><br><span class="line">    name VARCHAR NOT NULL</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line">CREATE TABLE books (</span><br><span class="line">    book_id serial PRIMARY KEY,</span><br><span class="line">    title VARCHAR NOT NULL,</span><br><span class="line">    isbn VARCHAR NOT NULL,</span><br><span class="line">    published_date DATE NOT NULL,</span><br><span class="line">    description VARCHAR,</span><br><span class="line">    category_id INT NOT NULL,</span><br><span class="line">    publisher_id INT NOT NULL,</span><br><span class="line">    FOREIGN KEY (publisher_id) REFERENCES publishers (publisher_id),</span><br><span class="line">    FOREIGN KEY (category_id) REFERENCES categories (category_id)</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br><span class="line"></span><br><span class="line">CREATE TABLE</span><br><span class="line"></span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建视图</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE VIEW book_info AS SELECT</span></span><br><span class="line">    book_id,</span><br><span class="line">    title,</span><br><span class="line">    isbn,</span><br><span class="line">    published_date,</span><br><span class="line">    name</span><br><span class="line">FROM</span><br><span class="line">    books b</span><br><span class="line">INNER JOIN publishers P ON P .publisher_id = b.publisher_id</span><br><span class="line">ORDER BY</span><br><span class="line">    title;</span><br><span class="line">CREATE VIEW</span><br></pre></td></tr></table></figure>
<blockquote>
<p>假设您要删除books表的category_id列，请使用以下语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE books DROP COLUMN category_id;</span></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查看表结构</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; \d books;</span><br><span class="line">                                       数据表 <span class="string">"public.books"</span></span><br><span class="line">      栏位      |       类型        | 校对规则 |  可空的  |                  预设                  </span><br><span class="line">----------------+-------------------+----------+----------+----------------------------------------</span><br><span class="line"> book_id        | <span class="built_in">integer</span>           |          | not null | nextval(<span class="string">'books_book_id_seq'</span>::regclass)</span><br><span class="line"> title          | character varying |          | not null | </span><br><span class="line"> isbn           | character varying |          | not null | </span><br><span class="line"> published_date | date              |          | not null | </span><br><span class="line"> description    | character varying |          |          | </span><br><span class="line"> publisher_id   | <span class="built_in">integer</span>           |          | not null | </span><br><span class="line">索引：</span><br><span class="line">    <span class="string">"books_pkey"</span> PRIMARY KEY, btree (book_id)</span><br><span class="line">外部键(FK)限制：</span><br><span class="line">    <span class="string">"books_publisher_id_fkey"</span> FOREIGN KEY (publisher_id) REFERENCES publishers(publisher_id)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如上，该语句不仅删除了category_id列，还删除了涉及该列的外键约束category_id。</p>
</blockquote>
<blockquote>
<p>尝试删除publisher_id列：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE books DROP COLUMN publisher_id;</span></span><br><span class="line">错误:  无法删除 表 books的列publisher_id 因为有其它对象倚赖它</span><br><span class="line">DETAIL:  视图 book_info 倚赖于 表 books的列publisher_id</span><br><span class="line">HINT:  使用 DROP .. CASCADE 把倚赖对象一并删除.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如上所示book_info视图正在使用books表的column_id列。您需要使用CASCADE选项来删除Publisher_id列和book_info视图，如以下语句所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE books DROP COLUMN publisher_id CASCADE;</span></span><br><span class="line">注意:  递归删除 视图 book_info</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要在单个语句中同时删除isbn和description列，请添加多个DROP COLUMN子句，如下所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE books</span></span><br><span class="line">  DROP COLUMN isbn,</span><br><span class="line">  DROP COLUMN description;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<h3 id="更改列类型"><a href="#更改列类型" class="headerlink" title="更改列类型"></a>更改列类型</h3><h4 id="更改列类型语法"><a href="#更改列类型语法" class="headerlink" title="更改列类型语法"></a>更改列类型语法</h4><blockquote>
<p>要更改列的数据类型，请使用ALTER TABLE语句，如下所示:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">ALTER COLUMN column_name [SET DATA] TYPE new_data_type;</span><br></pre></td></tr></table></figure>
<ul>
<li>首先，在ALTER TABLE子句中指定要更改的列所属的表的名称。</li>
</ul>
<ul>
<li>其次，在ALTER COLUMN子句中输入其数据类型将更改的列的名称。</li>
</ul>
<ul>
<li>第三，在TYPE关键字之后为列提供新的数据类型。可以使用SET DATA TYPE或TYPE。</li>
</ul>
<blockquote>
<p>要在单个语句中更改多个列的数据类型，请使用以下语法：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">ALTER COLUMN column_name_1 [SET DATA] TYPE new_data_type,</span><br><span class="line">ALTER COLUMN column_name_2 [SET DATA] TYPE new_data_type,</span><br><span class="line">...;</span><br></pre></td></tr></table></figure>
<ul>
<li>在此语法中，用逗号（，）分隔每个ALTER COLUMN子句，以便一次更改多个列的类型。</li>
</ul>
<blockquote>
<p>PostgreSQL允许通过添加USING子句，将旧的列值转换为新的列值，同时更改列的数据类型，如下所示:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">ALTER COLUMN column_name TYPE new_data_type USING expression;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用USING子句可以从旧值中计算出新的列值。</li>
</ul>
<ul>
<li>如果省略USING子句，则PostgreSQL会将旧的列值隐式转换为新的列值。如果强制转换失败，PostgreSQL将发出错误，并要求您为USING子句提供转换表达式。</li>
</ul>
<ul>
<li>表达式可以像column_name :: new_data_type这样简单，例如price :: numeric，也可以像自定义函数一样复杂。</li>
</ul>
<h4 id="更改列类型示例"><a href="#更改列类型示例" class="headerlink" title="更改列类型示例"></a>更改列类型示例</h4><blockquote>
<p>创建一个名为assets的新表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE assets (</span></span><br><span class="line">    id serial PRIMARY KEY,</span><br><span class="line">    name TEXT NOT NULL,</span><br><span class="line">    asset_no VARCHAR NOT NULL,</span><br><span class="line">    description TEXT,</span><br><span class="line">    LOCATION TEXT,</span><br><span class="line">    acquired_date DATE NOT NULL</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line">INSERT INTO assets (</span><br><span class="line">    NAME,</span><br><span class="line">    asset_no,</span><br><span class="line">    location,</span><br><span class="line">    acquired_date</span><br><span class="line">)</span><br><span class="line">VALUES</span><br><span class="line">    (</span><br><span class="line">        <span class="string">'Server'</span>,</span><br><span class="line">        <span class="string">'10001'</span>,</span><br><span class="line">        <span class="string">'Server room'</span>,</span><br><span class="line">        <span class="string">'2017-01-01'</span></span><br><span class="line">    ),</span><br><span class="line">    (</span><br><span class="line">        <span class="string">'UPS'</span>,</span><br><span class="line">        <span class="string">'10002'</span>,</span><br><span class="line">        <span class="string">'Server room'</span>,</span><br><span class="line">        <span class="string">'2018-08-08'</span></span><br><span class="line">	);</span><br><span class="line">CREATE TABLE</span><br><span class="line"></span><br><span class="line">INSERT 0 2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将name列的数据类型更改为VARCHAR:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE assets ALTER COLUMN name TYPE VARCHAR;</span></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将description和location列的数据类型从TEXT更改为VARCHAR:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE assets</span></span><br><span class="line">    ALTER COLUMN location TYPE VARCHAR,</span><br><span class="line">    ALTER COLUMN description TYPE VARCHAR;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将asset_no列的数据类型更改为整数</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE assets ALTER COLUMN asset_no TYPE INT;</span></span><br><span class="line">错误:  字段 <span class="string">"asset_no"</span> 不能自动转换成类型 <span class="built_in">integer</span></span><br><span class="line">HINT:  您可能需要指定<span class="string">"USING asset_no::integer"</span>。</span><br></pre></td></tr></table></figure>
<ul>
<li>PostgreSQL发出一个错误和一个非常有用的提示，要求您指定USING子句。</li>
</ul>
<blockquote>
<p>添加USING子句</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE assets</span></span><br><span class="line">    ALTER COLUMN asset_no TYPE INT USING asset_no::<span class="built_in">integer</span>;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<h3 id="RENAME-COLUMN子句"><a href="#RENAME-COLUMN子句" class="headerlink" title="RENAME COLUMN子句"></a>RENAME COLUMN子句</h3><h4 id="RENAME-COLUMN子句的语法"><a href="#RENAME-COLUMN子句的语法" class="headerlink" title="RENAME COLUMN子句的语法"></a>RENAME COLUMN子句的语法</h4><blockquote>
<p>要重命名表的列，请使用带有RENAME COLUMN子句的ALTER TABLE语句，如下所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">RENAME COLUMN column_name TO new_column_name;</span><br></pre></td></tr></table></figure>
<ul>
<li>首先，在ALTER TABLE子句之后，指定包含要重命名的列的表。</li>
</ul>
<ul>
<li>其次，在RENAME COLUMN子句后提供列名。</li>
</ul>
<ul>
<li>第三，在TO关键字之后输入新的列名称。</li>
</ul>
<blockquote>
<p>语句中的COLUMN关键字是可选的，因此可以忽略它，如以下语句所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">RENAME column_name TO new_column_name;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果尝试重命名不存在的列，PostgreSQL将发出错误。</li>
</ul>
<blockquote>
<p>要重命名多列，需要多次执行ALTER TABLE RENAME COLUMN语句，一次重命名一列:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name</span><br><span class="line">RENAME column_name_1 TO new_column_name_1;</span><br><span class="line"> </span><br><span class="line">ALTER TABLE table_name</span><br><span class="line">RENAME column_name_2 TO new_column_name_2;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果重命名由其他数据库对象（例如视图，外键约束，触发器和存储过程）引用的列，则PostgreSQL还将更改其所有从属对象。</p>
</blockquote>
<h4 id="RENAME-COLUMN示例"><a href="#RENAME-COLUMN示例" class="headerlink" title="RENAME COLUMN示例"></a>RENAME COLUMN示例</h4><blockquote>
<p>首先，创建两个新表cust和cust_groups。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE cust_groups (</span></span><br><span class="line">    id serial PRIMARY KEY,</span><br><span class="line">    name VARCHAR NOT NULL</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line">CREATE TABLE cust (</span><br><span class="line">    id serial PRIMARY KEY,</span><br><span class="line">    name VARCHAR NOT NULL,</span><br><span class="line">    phone VARCHAR NOT NULL,</span><br><span class="line">    email VARCHAR,</span><br><span class="line">    group_id INT,</span><br><span class="line">    FOREIGN KEY (group_id) REFERENCES cust_groups (id)</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br><span class="line"></span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>然后，基于cust和cust_groups表创建一个名为cust_data的新视图。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE VIEW cust_data</span></span><br><span class="line">AS SELECT</span><br><span class="line">    c.id,</span><br><span class="line">    c.name,</span><br><span class="line">    g.name cust_group</span><br><span class="line">FROM</span><br><span class="line">    cust c</span><br><span class="line">INNER JOIN cust_groups g ON g.id = c.group_id;</span><br><span class="line">CREATE VIEW</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用ALTER TABLE RENAME COLUMN语句将cust表的email列重命名为contact_email</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE cust</span></span><br><span class="line">RENAME COLUMN email TO contact_email;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用RENAME COLUMN重命名具有从属对象的列。将cust_groups表的name列重命名为group_name。 name列用于customer_data视图。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE cust_groups</span></span><br><span class="line">RENAME COLUMN name TO group_name;</span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>检查name列的更改是否已级联到cust_data视图</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt;  \d+ cust_data</span><br><span class="line">                           视图 <span class="string">"public.cust_data"</span></span><br><span class="line">    栏位    |       类型        | 校对规则 | 可空的 | 预设 |   存储   | 描述 </span><br><span class="line">------------+-------------------+----------+--------+------+----------+------</span><br><span class="line"> id         | <span class="built_in">integer</span>           |          |        |      | plain    | </span><br><span class="line"> name       | character varying |          |        |      | extended | </span><br><span class="line"> cust_group | character varying |          |        |      | extended | </span><br><span class="line">视图定义:</span><br><span class="line"> SELECT c.id,</span><br><span class="line">    c.name,</span><br><span class="line">    g.group_name AS cust_group</span><br><span class="line">   FROM cust c</span><br><span class="line">     JOIN cust_groups g ON g.id = c.group_id;</span><br></pre></td></tr></table></figure>
<ul>
<li>正如您在视图定义中看到的，name列已更改为group_name。</li>
</ul>
<blockquote>
<p>使用多个RENAME COLUMN重命名多个列。分别将customers表的两列name和phone重命名为customer_name和contact_phone。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE cust</span></span><br><span class="line">RENAME COLUMN name TO customer_name;</span><br><span class="line"> </span><br><span class="line">ALTER TABLE cust</span><br><span class="line">RENAME COLUMN phone TO contact_phone;</span><br><span class="line">ALTER TABLE</span><br><span class="line"></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<h3 id="DROP-TABLE语句"><a href="#DROP-TABLE语句" class="headerlink" title="DROP TABLE语句"></a>DROP TABLE语句</h3><h4 id="DROP-TABLE语法"><a href="#DROP-TABLE语法" class="headerlink" title="DROP TABLE语法"></a>DROP TABLE语法</h4><blockquote>
<p>要从数据库中删除现有表，请使用DROP TABLE语句</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE [IF EXISTS] table_name [CASCADE | RESTRICT];</span><br></pre></td></tr></table></figure>
<ul>
<li>可以在DROP TABLE关键字之后指定表名称，以从数据库中永久删除该表。</li>
</ul>
<ul>
<li>如果删除不存在的表，PostgreSQL会发出一个错误。为了避免这种情况，可以使用IF EXISTS参数，后跟DROP TABLE子句。</li>
</ul>
<ul>
<li>如果要删除的表用在视图、约束或任何其他对象中，则CASCADE允许您将那些从属对象与表一起自动删除。</li>
</ul>
<ul>
<li>如果有任何对象依赖，RESTRICT拒绝删除表。 PostgreSQL默认使用RESTRICT。</li>
</ul>
<ul>
<li><p>可以在DROP TABLE之后放置一个表列表，以一次删除多个表，每个表之间用逗号分隔。</p>
</li>
<li><p>请注意，只有超级用户，schema所有者和表所有者才具有删除表的足够特权。</p>
</li>
</ul>
<h4 id="DROP-TABLE示例"><a href="#DROP-TABLE示例" class="headerlink" title="DROP TABLE示例"></a>DROP TABLE示例</h4><blockquote>
<p>在数据库中删除名为author的表:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">est=<span class="comment"># DROP TABLE author;</span></span><br><span class="line">错误:  表 <span class="string">"author"</span> 不存在</span><br></pre></td></tr></table></figure>
<ul>
<li>PostgreSQL发出错误，因为author表不存在。</li>
</ul>
<blockquote>
<p>为避免此错误，可以使用IF EXISTS参数。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># DROP TABLE IF EXISTS author;</span></span><br><span class="line">注意:  表 <span class="string">"author"</span> 不存在</span><br><span class="line">DROP TABLE</span><br></pre></td></tr></table></figure>
<ul>
<li>从输出中可以清楚地看到，PostgreSQL发出通知而不是错误。</li>
</ul>
<blockquote>
<p>创建名为author和page的新表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE author (</span></span><br><span class="line">   author_id INT NOT NULL PRIMARY KEY,</span><br><span class="line">   firstname VARCHAR (50),</span><br><span class="line">   lastname VARCHAR (50)</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line">CREATE TABLE page (</span><br><span class="line">   page_id serial PRIMARY KEY,</span><br><span class="line">   title VARCHAR (255) NOT NULL,</span><br><span class="line">   CONTENT TEXT,</span><br><span class="line">   author_id INT NOT NULL,</span><br><span class="line">   FOREIGN KEY (author_id) REFERENCES author (author_id)</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br><span class="line"></span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>以下语句删除author表：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># DROP TABLE IF EXISTS author;</span></span><br><span class="line">错误:  无法删除 表 author 因为有其它对象倚赖它</span><br><span class="line">DETAIL:  在表 page上的约束page_author_id_fkey  倚赖于 表 author</span><br><span class="line">HINT:  使用 DROP .. CASCADE 把倚赖对象一并删除.</span><br></pre></td></tr></table></figure>
<ul>
<li>因为page表的约束取决于author表，所以PostgreSQL发出一条错误消息。</li>
</ul>
<blockquote>
<p>在这种情况下，需要先删除所有依赖对象，然后再删除author表或使用CASCADE参数，如下：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># DROP TABLE author CASCADE;</span></span><br><span class="line">注意:  递归删除 在表 page上的约束page_author_id_fkey</span><br><span class="line">DROP TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PostgreSQL删除了author表以及page表中的约束。另外，它发出通知。</p>
</blockquote>
<h3 id="TRUNCATE-TABLE语句"><a href="#TRUNCATE-TABLE语句" class="headerlink" title="TRUNCATE TABLE语句"></a>TRUNCATE TABLE语句</h3><blockquote>
<p>要从表中删除所有数据，请使用DELETE语句。但是，对于大表，使用TRUNCATE TABLE语句效率更高。</p>
</blockquote>
<blockquote>
<p>TRUNCATE TABLE语句从表中删除所有行，而无需对其进行扫描。这就是为什么它比DELETE语句快的原因。</p>
</blockquote>
<blockquote>
<p>此外，TRUNCATE TABLE语句可以立即回收存储，因此不必执行后续的VACUMM操作，这在大表的情况下很有用。</p>
</blockquote>
<h4 id="从一个表中删除所有数据"><a href="#从一个表中删除所有数据" class="headerlink" title="从一个表中删除所有数据"></a>从一个表中删除所有数据</h4><blockquote>
<p>TRUNCATE TABLE语句的最简单形式如下:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE table_name;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例如，要从invoices表中删除所有行，请使用以下语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE invoices;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TRUNCATE TABLE语句不仅可以从表中删除所有数据，还可以通过指定RESTART IDENTITY选项来重置关联的序列生成器:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE table_name RESTART IDENTITY;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例如，要从invoices表中删除所有行并重置与invoice_no列关联的序列，请使用以下语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE invoices RESTART IDENTITY;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认情况下，TRUNCATE TABLE语句不会重置关联的序列。您可以在语句中显式使用CONTINUE IDENTITY选项来保留序列。但是，这不是必需的。</p>
</blockquote>
<h4 id="从多个表中删除所有数据"><a href="#从多个表中删除所有数据" class="headerlink" title="从多个表中删除所有数据"></a>从多个表中删除所有数据</h4><blockquote>
<p>要一次从多个表中删除所有数据，请用逗号(，)分隔每个表，如下所示:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE table_name1, table_name2, …</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例如，以下语句从invoices和customers表中删除所有数据：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE invoices, customers;</span><br></pre></td></tr></table></figure>
<h4 id="从具有外键引用的表中删除所有数据"><a href="#从具有外键引用的表中删除所有数据" class="headerlink" title="从具有外键引用的表中删除所有数据"></a>从具有外键引用的表中删除所有数据</h4><blockquote>
<p>实际上，要截断的表通常具有来自其他表的外键引用，这些外键引用未在TRUNCATE TABLE语句中列出。默认情况下，TRUNCATE TABLE语句不会从具有外键引用的表中删除任何数据。</p>
</blockquote>
<blockquote>
<p>要从主表和具有对该主表的外键引用的所有表中删除数据，请使用CASCADE选项，如下所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE table_name CASCADE;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例如，要从invoices表中删除所有数据并通过invoices外键约束级联到引用该表的任何表，请使用以下语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE invoices CASCADE;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用 CASCADE 选项时应格外小心，否则可能会从您不希望删除的表中删除数据。</p>
</blockquote>
<h4 id="TRUNCATE-TABLE和ON-DELETE触发器"><a href="#TRUNCATE-TABLE和ON-DELETE触发器" class="headerlink" title="TRUNCATE TABLE和ON DELETE触发器"></a>TRUNCATE TABLE和ON DELETE触发器</h4><blockquote>
<p>即使TRUNCATE TABLE语句从表中删除了所有数据，它也不会触发与该表关联的任何ON DELETE触发器。</p>
</blockquote>
<blockquote>
<p>要在将TRUNCATE TABLE命令应用于表时触发该触发器，必须为该表定义BEFORE TRUNCATE和/或AFTER TRUNCATE触发器。</p>
</blockquote>
<h4 id="TRUNCATE-TABLE和事务"><a href="#TRUNCATE-TABLE和事务" class="headerlink" title="TRUNCATE TABLE和事务"></a>TRUNCATE TABLE和事务</h4><blockquote>
<p>TRUNCATE TABLE是事务安全的。这意味着，如果将其放置在诸如BEGIN…ROLLBACK之类的事务语句中，则截断操作将被安全地回滚。</p>
</blockquote>
<h3 id="临时表"><a href="#临时表" class="headerlink" title="临时表"></a>临时表</h3><blockquote>
<p>临时表，顾名思义，是一个暂时存在的表，在数据库会话期间一直存在。PostgreSQL在会话或事务结束时自动删除临时表。</p>
</blockquote>
<h4 id="创建临时表语法"><a href="#创建临时表语法" class="headerlink" title="创建临时表语法"></a>创建临时表语法</h4><blockquote>
<p>要创建临时表，请使用CREATE TEMPORARY TABLE语句:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TEMPORARY TABLE temp_table(</span><br><span class="line">   ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以使用TEMP而不是TEMPORARY关键字:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TEMP TABLE temp_table(</span><br><span class="line">   ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>临时表仅对创建它的会话可见。换句话说，它对于其他会话仍然不可见。</p>
</blockquote>
<h4 id="临时表示例"><a href="#临时表示例" class="headerlink" title="临时表示例"></a>临时表示例</h4><blockquote>
<p>首先，创建一个名为mytemp的临时表，如下所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; CREATE TEMP TABLE mytemp(c INT);</span><br><span class="line">CREATE TABLE</span><br><span class="line"><span class="built_in">test</span>=&gt; SELECT * FROM mytemp;</span><br><span class="line"> c </span><br><span class="line">---</span><br><span class="line">(0 行记录)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>然后，启动另一个连接到test数据库的会话，并从mytemp表查询数据：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT * FROM mytemp;</span></span><br><span class="line">错误:  关系 <span class="string">"mytemp"</span> 不存在</span><br><span class="line">LINE 1: SELECT * FROM mytemp</span><br><span class="line">                      ^</span><br></pre></td></tr></table></figure>
<ul>
<li>可以看到，第二个会话看不到mytemp表。只有第一个会话可以访问它。</li>
</ul>
<blockquote>
<p>之后，退出所有会话:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; \q</span><br></pre></td></tr></table></figure>
<blockquote>
<p>最后，再次登录数据库服务器并从mytemp表查询数据</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; SELECT * FROM mytemp;</span><br><span class="line">错误:  关系 <span class="string">"mytemp"</span> 不存在</span><br><span class="line">第1行SELECT * FROM mytemp;</span><br></pre></td></tr></table></figure>
<ul>
<li>mytemp表不存在，因为在会话结束时已自动将其删除，因此PostgreSQL发出错误。</li>
</ul>
<h4 id="临时表表名"><a href="#临时表表名" class="headerlink" title="临时表表名"></a>临时表表名</h4><blockquote>
<p>临时表可以与永久表共享相同的名称，即使不建议这样做。当您创建一个与永久表同名的临时表时，除非删除该临时表，否则将无法访问该永久表。</p>
</blockquote>
<blockquote>
<p>首先，创建一个名为test7的表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE test7(id SERIAL PRIMARY KEY, name VARCHAR NOT NULL);</span></span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其次，创建一个具有相同名称的临时表test7</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TEMP TABLE test7(test_id INT);</span></span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>现在，从test7表中查询数据</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; SELECT * FROM test7;</span><br><span class="line"> test_id </span><br><span class="line">---------</span><br><span class="line">(0 行记录)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PostgreSQL访问临时表客户而不是永久表客户。从现在开始，仅当显式删除临时表客户时，才能在当前会话中访问永久客户表。</p>
</blockquote>
<blockquote>
<p>请注意，PostgreSQL在特殊模式中创建临时表，因此，不得在CREATE TEMP TABLE语句中指定模式。</p>
</blockquote>
<blockquote>
<p>如果在数据库中列出表，则只会看到临时表客户，而不是永久表客户：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; \d test7</span><br><span class="line">           数据表 <span class="string">"pg_temp_4.test7"</span></span><br><span class="line">  栏位   |  类型   | 校对规则 | 可空的 | 预设 </span><br><span class="line">---------+---------+----------+--------+------</span><br><span class="line"> test_id | <span class="built_in">integer</span> |          |        |</span><br></pre></td></tr></table></figure>
<ul>
<li>输出显示test7临时表的模式为pg_temp_4。</li>
</ul>
<h4 id="删除PostgreSQL临时表"><a href="#删除PostgreSQL临时表" class="headerlink" title="删除PostgreSQL临时表"></a>删除PostgreSQL临时表</h4><blockquote>
<p>要删除临时表，请使用DROP TABLE语句。以下语句说明了如何删除临时表:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE temp_table_name;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>与CREATE TABLE语句不同，DROP TABLE语句没有专门为临时表创建的TEMP或TEMPORARY关键字。</p>
</blockquote>
<blockquote>
<p>例如，以下语句将删除在上面的示例中创建的临时表test7：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; DROP TABLE test7;</span><br><span class="line">DROP TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果再次在数据库中列出表，则永久表客户将显示如下：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=&gt; \d test7</span><br><span class="line">                               数据表 <span class="string">"public.test7"</span></span><br><span class="line"> 栏位 |       类型        | 校对规则 |  可空的  |               预设                </span><br><span class="line">------+-------------------+----------+----------+-----------------------------------</span><br><span class="line"> id   | <span class="built_in">integer</span>           |          | not null | nextval(<span class="string">'test7_id_seq'</span>::regclass)</span><br><span class="line"> name | character varying |          | not null | </span><br><span class="line">索引：</span><br><span class="line">    <span class="string">"test7_pkey"</span> PRIMARY KEY, btree (id)</span><br></pre></td></tr></table></figure>
<h3 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h3><h4 id="复制表语句语法"><a href="#复制表语句语法" class="headerlink" title="复制表语句语法"></a>复制表语句语法</h4><blockquote>
<p>要完全复制一个表，包括表结构和数据，请使用以下语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE new_table AS</span><br><span class="line">TABLE existing_table;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要复制不包含数据的表结构，可将WITH NO DATA子句添加到CREATE TABLE语句中，如下所示：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE new_table AS</span><br><span class="line">TABLE existing_table</span><br><span class="line">WITH NO DATA;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要从现有表复制包含部分数据的表，请使用以下语句：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE new_table AS</span><br><span class="line">SELECT</span><br><span class="line">*</span><br><span class="line">FROM</span><br><span class="line">    existing_table</span><br><span class="line">WHERE</span><br><span class="line">    condition;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>WHERE查询子句中的条件定义了现有表的哪些行将被复制到新表。</p>
</blockquote>
<blockquote>
<p>请注意，以上所有语句均复制表结构和数据，但不复制现有表的索引和约束。</p>
</blockquote>
<h4 id="复制表示例"><a href="#复制表示例" class="headerlink" title="复制表示例"></a>复制表示例</h4><blockquote>
<p>创建一个名为contacts的新表</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE contacts(</span></span><br><span class="line">    id SERIAL PRIMARY KEY,</span><br><span class="line">    first_name VARCHAR NOT NULL,</span><br><span class="line">    last_name VARCHAR NOT NULL,</span><br><span class="line">    email VARCHAR NOT NULL UNIQUE</span><br><span class="line">);</span><br><span class="line">CREATE TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在该表中有两个索引：一个索引用于主键，另一个索引用于UNIQUE约束。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># INSERT INTO contacts(first_name, last_name, email)</span></span><br><span class="line">VALUES(<span class="string">'John'</span>,<span class="string">'Doe'</span>,<span class="string">'john@pg.com'</span>),</span><br><span class="line">      (<span class="string">'David'</span>,<span class="string">'William'</span>,<span class="string">'david@pg.com'</span>);</span><br><span class="line">INSERT 0 2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将联系人复制到新表（例如，contacts_backup表）中</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># CREATE TABLE contact_backup</span></span><br><span class="line">AS TABLE contacts;</span><br><span class="line">SELECT 2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>该语句创建一个名为contact_backup的新表，该表的结构与contacts表相同。 此外，它将数据从联系人表复制到contact_backup表。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># SELECT * FROM contact_backup;</span></span><br><span class="line"> id | first_name | last_name |    email</span><br><span class="line">----+------------+-----------+--------------</span><br><span class="line">  1 | John       | Doe       | john@pg.com</span><br><span class="line">  2 | David      | William   | david@pg.com</span><br><span class="line">(2 rows)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>检查表结构</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>-&gt; \d contacts</span><br><span class="line">                                  数据表 <span class="string">"public.contacts"</span></span><br><span class="line">    栏位    |       类型        | 校对规则 |  可空的  |                 预设                 </span><br><span class="line">------------+-------------------+----------+----------+--------------------------------------</span><br><span class="line"> id         | <span class="built_in">integer</span>           |          | not null | nextval(<span class="string">'contacts_id_seq'</span>::regclass)</span><br><span class="line"> first_name | character varying |          | not null | </span><br><span class="line"> last_name  | character varying |          | not null | </span><br><span class="line"> email      | character varying |          | not null | </span><br><span class="line">索引：</span><br><span class="line">    <span class="string">"contacts_pkey"</span> PRIMARY KEY, btree (id)</span><br><span class="line">    <span class="string">"contacts_email_key"</span> UNIQUE CONSTRAINT, btree (email)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>-&gt; \d contact_backup</span><br><span class="line">              数据表 <span class="string">"public.contact_backup"</span></span><br><span class="line">    栏位    |       类型        | 校对规则 | 可空的 | 预设 </span><br><span class="line">------------+-------------------+----------+--------+------</span><br><span class="line"> id         | <span class="built_in">integer</span>           |          |        | </span><br><span class="line"> first_name | character varying |          |        | </span><br><span class="line"> last_name  | character varying |          |        | </span><br><span class="line"> email      | character varying |          |        |</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要将主键和UNIQUE约束添加到contact_backup表中，请使用以下ALTER TABLE语句:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>=<span class="comment"># ALTER TABLE contact_backup ADD PRIMARY KEY(id);</span></span><br><span class="line">ALTER TABLE contact_backup ADD UNIQUE(email);</span><br><span class="line">ALTER TABLE</span><br><span class="line"></span><br><span class="line">ALTER TABLE</span><br></pre></td></tr></table></figure>
<blockquote>
<p>再次查看表结构</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>-&gt; \d contact_backup</span><br><span class="line">               数据表 <span class="string">"public.contact_backup"</span></span><br><span class="line">    栏位    |       类型        | 校对规则 |  可空的  | 预设 </span><br><span class="line">------------+-------------------+----------+----------+------</span><br><span class="line"> id         | <span class="built_in">integer</span>           |          | not null | </span><br><span class="line"> first_name | character varying |          |          | </span><br><span class="line"> last_name  | character varying |          |          | </span><br><span class="line"> email      | character varying |          |          | </span><br><span class="line">索引：</span><br><span class="line">    <span class="string">"contact_backup_pkey"</span> PRIMARY KEY, btree (id)</span><br><span class="line">    <span class="string">"contact_backup_email_key"</span> UNIQUE CONSTRAINT, btree (email)</span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/weixin.jpg" alt="ZhiJian wechat" style="width: auto; height:250px; max-width: 100%;">
    <div>欢迎您扫一扫上面的二维码，订阅我的微信公众号！</div>
</div>

      </div>
    

    
       
    
    

    
    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束,感谢您的阅读-------------</div>
    
</div>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/pg/" rel="tag"><i class="fa fa-tag"></i> pg</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/pg8/" rel="next" title="PostgreSQL之数据处理">
                <i class="fa fa-chevron-left"></i> PostgreSQL之数据处理
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/pg10/" rel="prev" title="PostgreSQL之数据库约束和数据库类型">
                PostgreSQL之数据库约束和数据库类型 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="ZhiJian">
            
              <p class="site-author-name" itemprop="name">ZhiJian</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">44</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">26</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/zhijiansd" title="GitHub &rarr; https://github.com/zhijiansd" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:wangzhijiansd@qq.com" title="E-Mail &rarr; mailto:wangzhijiansd@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="/zhitalk" title="weixin &rarr; zhitalk"><i class="fa fa-fw fa-weixin"></i>weixin</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://blog.51cto.com/wangzhijian" title="51blog &rarr; http://blog.51cto.com/wangzhijian" rel="noopener" target="_blank"><i class="fa fa-fw fa-pied-piper"></i>51blog</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#管理数据库"><span class="nav-number">1.</span> <span class="nav-text">管理数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CREATE-DATABASE语句"><span class="nav-number">1.1.</span> <span class="nav-text">CREATE DATABASE语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CREATE-DATABASE语法"><span class="nav-number">1.1.1.</span> <span class="nav-text">CREATE DATABASE语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建数据库示例1"><span class="nav-number">1.1.2.</span> <span class="nav-text">创建数据库示例1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建数据库示例2"><span class="nav-number">1.1.3.</span> <span class="nav-text">创建数据库示例2</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ALTER-DATABASE语句"><span class="nav-number">1.2.</span> <span class="nav-text">ALTER DATABASE语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ALTER-DATABASE"><span class="nav-number">1.2.1.</span> <span class="nav-text">ALTER DATABASE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重命名数据库"><span class="nav-number">1.2.2.</span> <span class="nav-text">重命名数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#变更拥有者"><span class="nav-number">1.2.3.</span> <span class="nav-text">变更拥有者</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#变更表空间"><span class="nav-number">1.2.4.</span> <span class="nav-text">变更表空间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#更改运行时配置变量的会话默认值"><span class="nav-number">1.2.5.</span> <span class="nav-text">更改运行时配置变量的会话默认值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ALTER-DATABASE示例"><span class="nav-number">1.2.6.</span> <span class="nav-text">ALTER DATABASE示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ALTER-DATABASE-RENAME-TO-语句"><span class="nav-number">1.3.</span> <span class="nav-text">ALTER DATABASE RENAME TO 语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#重命名数据库步骤"><span class="nav-number">1.3.1.</span> <span class="nav-text">重命名数据库步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重命名数据库示例"><span class="nav-number">1.3.2.</span> <span class="nav-text">重命名数据库示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DROP-DATABASE-语句"><span class="nav-number">1.4.</span> <span class="nav-text">DROP DATABASE 语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DROP-DATABASE语法"><span class="nav-number">1.4.1.</span> <span class="nav-text">DROP DATABASE语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#删除具有活动连接的数据库"><span class="nav-number">1.4.2.</span> <span class="nav-text">删除具有活动连接的数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DROP-DATABASE示例"><span class="nav-number">1.4.3.</span> <span class="nav-text">DROP DATABASE示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#创建示例数据库"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">创建示例数据库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#删除没有活动连接的数据库"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">删除没有活动连接的数据库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#删除具有活动连接的数据库-1"><span class="nav-number">1.4.3.3.</span> <span class="nav-text">删除具有活动连接的数据库</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复制数据库"><span class="nav-number">1.5.</span> <span class="nav-text">复制数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#复制同一服务器内的数据库"><span class="nav-number">1.5.1.</span> <span class="nav-text">复制同一服务器内的数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#将数据库从服务器复制到另一个服务器"><span class="nav-number">1.5.2.</span> <span class="nav-text">将数据库从服务器复制到另一个服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#复制步骤"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">复制步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取数据库对象大小"><span class="nav-number">1.6.</span> <span class="nav-text">获取数据库对象大小</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PostgreSQL表大小"><span class="nav-number">1.6.1.</span> <span class="nav-text">PostgreSQL表大小</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PostgreSQL数据库大小"><span class="nav-number">1.6.2.</span> <span class="nav-text">PostgreSQL数据库大小</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PostgreSQL索引大小"><span class="nav-number">1.6.3.</span> <span class="nav-text">PostgreSQL索引大小</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PostgreSQL表空间大小"><span class="nav-number">1.6.4.</span> <span class="nav-text">PostgreSQL表空间大小</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PostgreSQL值大小"><span class="nav-number">1.6.5.</span> <span class="nav-text">PostgreSQL值大小</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#管理表"><span class="nav-number">2.</span> <span class="nav-text">管理表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据类型"><span class="nav-number">2.1.</span> <span class="nav-text">数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#布尔型"><span class="nav-number">2.1.1.</span> <span class="nav-text">布尔型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字符类型"><span class="nav-number">2.1.2.</span> <span class="nav-text">字符类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数值类型"><span class="nav-number">2.1.3.</span> <span class="nav-text">数值类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#时间类型"><span class="nav-number">2.1.4.</span> <span class="nav-text">时间类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数组"><span class="nav-number">2.1.5.</span> <span class="nav-text">数组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSON格式"><span class="nav-number">2.1.6.</span> <span class="nav-text">JSON格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UUID"><span class="nav-number">2.1.7.</span> <span class="nav-text">UUID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#特殊数据类型"><span class="nav-number">2.1.8.</span> <span class="nav-text">特殊数据类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CREATE-TABLE语句"><span class="nav-number">2.2.</span> <span class="nav-text">CREATE TABLE语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CREATE-TABLE语法"><span class="nav-number">2.2.1.</span> <span class="nav-text">CREATE TABLE语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PostgreSQL列约束"><span class="nav-number">2.2.2.</span> <span class="nav-text">PostgreSQL列约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PostgreSQL表约束"><span class="nav-number">2.2.3.</span> <span class="nav-text">PostgreSQL表约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CREATE-TABLE示例1"><span class="nav-number">2.2.4.</span> <span class="nav-text">CREATE TABLE示例1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CREATE-TABLE示例2"><span class="nav-number">2.2.5.</span> <span class="nav-text">CREATE TABLE示例2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CREATE-TABLE示例3"><span class="nav-number">2.2.6.</span> <span class="nav-text">CREATE TABLE示例3</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SELECT-INTO语句"><span class="nav-number">2.3.</span> <span class="nav-text">SELECT INTO语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SELECT-INTO语句语法"><span class="nav-number">2.3.1.</span> <span class="nav-text">SELECT INTO语句语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SELECT-INTO示例1"><span class="nav-number">2.3.2.</span> <span class="nav-text">SELECT INTO示例1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SELECT-INTO示例2"><span class="nav-number">2.3.3.</span> <span class="nav-text">SELECT INTO示例2</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CREATE-TABLE-AS语句"><span class="nav-number">2.4.</span> <span class="nav-text">CREATE TABLE AS语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CREATE-TABLE-AS语句语法"><span class="nav-number">2.4.1.</span> <span class="nav-text">CREATE TABLE AS语句语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CREATE-TABLE-AS语句示例1"><span class="nav-number">2.4.2.</span> <span class="nav-text">CREATE TABLE AS语句示例1</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用PostgreSQL-SERIAL创建自动增量列"><span class="nav-number">2.5.</span> <span class="nav-text">使用PostgreSQL SERIAL创建自动增量列</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SERIAL-pseudo-type-语法"><span class="nav-number">2.5.1.</span> <span class="nav-text">SERIAL pseudo-type 语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SERIAL范例1"><span class="nav-number">2.5.2.</span> <span class="nav-text">SERIAL范例1</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CREATE-SEQUENCE语句"><span class="nav-number">2.6.</span> <span class="nav-text">CREATE SEQUENCE语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CREATE-SEQUENCE语句语法"><span class="nav-number">2.6.1.</span> <span class="nav-text">CREATE SEQUENCE语句语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建升序序列示例"><span class="nav-number">2.6.2.</span> <span class="nav-text">创建升序序列示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建一个降序示例"><span class="nav-number">2.6.3.</span> <span class="nav-text">创建一个降序示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建与表列关联的序列"><span class="nav-number">2.6.4.</span> <span class="nav-text">创建与表列关联的序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#列出数据库中的所有序列"><span class="nav-number">2.6.5.</span> <span class="nav-text">列出数据库中的所有序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DROP-SEQUENCE语句示例"><span class="nav-number">2.6.6.</span> <span class="nav-text">DROP SEQUENCE语句示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GENERATED-AS-IDENTITY约束"><span class="nav-number">2.7.</span> <span class="nav-text">GENERATED AS IDENTITY约束</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#GENERATED-AS-IDENTITY约束的语法"><span class="nav-number">2.7.1.</span> <span class="nav-text">GENERATED AS IDENTITY约束的语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GENERATED-ALWAYS示例"><span class="nav-number">2.7.2.</span> <span class="nav-text">GENERATED ALWAYS示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GENERATED-BY-DEFAULT-AS-IDENTITY示例"><span class="nav-number">2.7.3.</span> <span class="nav-text">GENERATED BY DEFAULT AS IDENTITY示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SEQUENCE选项示例"><span class="nav-number">2.7.4.</span> <span class="nav-text">SEQUENCE选项示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#将标识列添加到现有表"><span class="nav-number">2.7.5.</span> <span class="nav-text">将标识列添加到现有表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#更改身份列"><span class="nav-number">2.7.6.</span> <span class="nav-text">更改身份列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#除去GENERATED-AS-IDENTITY约束"><span class="nav-number">2.7.7.</span> <span class="nav-text">除去GENERATED AS IDENTITY约束</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ALTER-TABLE语句"><span class="nav-number">2.8.</span> <span class="nav-text">ALTER TABLE语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ALTER-TABLE语法"><span class="nav-number">2.8.1.</span> <span class="nav-text">ALTER TABLE语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ALTER-TABLE示例"><span class="nav-number">2.8.2.</span> <span class="nav-text">ALTER TABLE示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RENAME-TO子句"><span class="nav-number">2.9.</span> <span class="nav-text">RENAME TO子句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#重命名表语法"><span class="nav-number">2.9.1.</span> <span class="nav-text">重命名表语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重命名表示例"><span class="nav-number">2.9.2.</span> <span class="nav-text">重命名表示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ADD-COLUMN语句"><span class="nav-number">2.10.</span> <span class="nav-text">ADD COLUMN语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ADD-COLUMN语句语法"><span class="nav-number">2.10.1.</span> <span class="nav-text">ADD COLUMN语句语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ADD-COLUMN示例"><span class="nav-number">2.10.2.</span> <span class="nav-text">ADD COLUMN示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#将具有NOT-NULL约束的列添加到具有数据的表中"><span class="nav-number">2.10.3.</span> <span class="nav-text">将具有NOT NULL约束的列添加到具有数据的表中</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DROP-COLUMN子句"><span class="nav-number">2.11.</span> <span class="nav-text">DROP COLUMN子句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DROP-COLUMN子句的语法"><span class="nav-number">2.11.1.</span> <span class="nav-text">DROP COLUMN子句的语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DROP-COLUMN示例"><span class="nav-number">2.11.2.</span> <span class="nav-text">DROP COLUMN示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更改列类型"><span class="nav-number">2.12.</span> <span class="nav-text">更改列类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#更改列类型语法"><span class="nav-number">2.12.1.</span> <span class="nav-text">更改列类型语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#更改列类型示例"><span class="nav-number">2.12.2.</span> <span class="nav-text">更改列类型示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RENAME-COLUMN子句"><span class="nav-number">2.13.</span> <span class="nav-text">RENAME COLUMN子句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RENAME-COLUMN子句的语法"><span class="nav-number">2.13.1.</span> <span class="nav-text">RENAME COLUMN子句的语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RENAME-COLUMN示例"><span class="nav-number">2.13.2.</span> <span class="nav-text">RENAME COLUMN示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DROP-TABLE语句"><span class="nav-number">2.14.</span> <span class="nav-text">DROP TABLE语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DROP-TABLE语法"><span class="nav-number">2.14.1.</span> <span class="nav-text">DROP TABLE语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DROP-TABLE示例"><span class="nav-number">2.14.2.</span> <span class="nav-text">DROP TABLE示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TRUNCATE-TABLE语句"><span class="nav-number">2.15.</span> <span class="nav-text">TRUNCATE TABLE语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#从一个表中删除所有数据"><span class="nav-number">2.15.1.</span> <span class="nav-text">从一个表中删除所有数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#从多个表中删除所有数据"><span class="nav-number">2.15.2.</span> <span class="nav-text">从多个表中删除所有数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#从具有外键引用的表中删除所有数据"><span class="nav-number">2.15.3.</span> <span class="nav-text">从具有外键引用的表中删除所有数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TRUNCATE-TABLE和ON-DELETE触发器"><span class="nav-number">2.15.4.</span> <span class="nav-text">TRUNCATE TABLE和ON DELETE触发器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TRUNCATE-TABLE和事务"><span class="nav-number">2.15.5.</span> <span class="nav-text">TRUNCATE TABLE和事务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#临时表"><span class="nav-number">2.16.</span> <span class="nav-text">临时表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建临时表语法"><span class="nav-number">2.16.1.</span> <span class="nav-text">创建临时表语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#临时表示例"><span class="nav-number">2.16.2.</span> <span class="nav-text">临时表示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#临时表表名"><span class="nav-number">2.16.3.</span> <span class="nav-text">临时表表名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#删除PostgreSQL临时表"><span class="nav-number">2.16.4.</span> <span class="nav-text">删除PostgreSQL临时表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复制表"><span class="nav-number">2.17.</span> <span class="nav-text">复制表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#复制表语句语法"><span class="nav-number">2.17.1.</span> <span class="nav-text">复制表语句语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#复制表示例"><span class="nav-number">2.17.2.</span> <span class="nav-text">复制表示例</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhiJian</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">761k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">21:09</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.5.0</div>





        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
      
  
  <script type="text/javascript" color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.5.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.5.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.5.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.5.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.5.0"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'YDspHswalVwn03xuqlx5EKQF-gzGzoHsz',
        appKey: 'pA3bP9yhf50EIhapICs6ohRC',
        placeholder: '欢迎评论',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: false
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  

  

  

  

  

  

  


  
     <script type="text/javascript" color="255,48,48" opacity="0.7" zindex="-2" count="150" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  

</body>
</html>
